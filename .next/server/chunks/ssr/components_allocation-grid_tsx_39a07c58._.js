module.exports=[74015,a=>{"use strict";var b=a.i(46447),c=a.i(30564),d=a.i(40695);function e({userId:a,monthIndex:d,allocations:e=[],onEdit:f,onSaveEdit:g,onRemove:h,onEmptyCellClick:i,projects:j=[],users:k=[],userEnded:l=!1,userNotStarted:m=!1,viewMode:n="percentage",getDaysFromPercentage:o,readOnly:p=!1}){let[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(0),w=(a,b,c)=>{if(o)return o(a,b,c);let d=Math.floor(b/12)+2024,e=b%12,f=new Date(d,e,1),g=new Date(d,e+1,0).getDate(),h=0;for(let a=1;a<=g;a++){f.setDate(a);let b=f.getDay();b>=1&&b<=5&&h++}return Math.round(c/100*h)},x=e.reduce((a,b)=>a+(b.percentage||0),0),y=Math.max(0,100-x);return(0,b.jsx)("td",{"data-user-id":a,"data-month":d,className:`w-32 border-r border-b border-border bg-background px-1 py-0.5 min-h-8 transition-colors relative ${l||m||p?"cursor-not-allowed bg-gray-50":y>0&&i?"cursor-pointer hover:bg-muted/50":"hover:bg-muted/30"}`,onMouseEnter:()=>!l&&!m&&!p&&y>0&&r(!0),onMouseLeave:()=>r(!1),onClick:l||m||p?void 0:()=>{y>0&&i&&!m&&i()},children:(0,b.jsxs)("div",{className:"flex flex-col h-full gap-0.5",children:[(0,b.jsxs)("div",{className:"flex items-center flex-1",children:[(0,b.jsx)("div",{className:`flex w-full h-4 rounded overflow-hidden bg-gray-100 ${100===x?"border-2 border-green-500":x>100?"border-2 border-red-500":""}`,children:l?(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center text-[8px] font-semibold text-gray-500 bg-gray-200",children:"ended"}):m?(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center text-[8px] font-semibold text-gray-500 bg-gray-200",children:"not started"}):e.map(c=>{let e=j.find(a=>a.id===c.projectId);console.log("[v0] AllocationCell rendering bar:",{allocationId:c.id,projectId:c.projectId,projectColor:e?.color});let g=Math.max(0,Math.min(100,(c.percentage||0)/(x>100?x:100)*100)),i="days"===n?Math.round(w(a,d,c.percentage||0)):Math.round(c.percentage||0),k="days"===n?`${i} days`:`${i}%`;return w(a,d,c.percentage||0),(0,b.jsxs)("div",{className:`h-full text-[8px] flex items-center justify-center font-semibold relative ${p?"":"group cursor-pointer"} text-white`,style:{backgroundColor:e?.color||"#999",width:`${g}%`,minWidth:g>0?"8%":void 0},onClick:a=>{p||(a.stopPropagation(),f?.(c.id))},title:`${e?.name??"Project"} - ${c.positionName||c.name||"Position"} (${k})`,children:[k,!p&&(0,b.jsx)("button",{onClick:a=>{a.stopPropagation(),h?.(c.id)},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity",children:"Ã—"})]},c.id)})}),!l&&!m&&x>=90&&x<=100&&e.length>0&&(0,b.jsx)("div",{className:"ml-1 flex-shrink-0",children:(0,b.jsx)("svg",{className:"w-4 h-4 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),!l&&!m&&!p&&q&&y>0&&(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-primary/10 rounded text-[9px] text-primary font-medium pointer-events-none",children:"Click to select position"})]})})}function f({projects:a,positions:d=[],months:e,startMonth:f=0,startYear:g=2024,onAddProject:h,onUpdateProject:i,onDeleteProject:j,onUpdatePositions:k,onProjectSelect:l,selectedProjectId:m,onCleanupAllocations:n,currentUserRole:o}){let p,[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)("#3B82F6"),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)(0),[C,D]=(0,c.useState)(2024),[E,F]=(0,c.useState)(0),[G,H]=(0,c.useState)(2024),[I,J]=(0,c.useState)(0),[K,L]=(0,c.useState)("percentage"),M="admin"===o||"editor"===o,N=["January","February","March","April","May","June","July","August","September","October","November","December"],O=Array.from({length:10},(a,b)=>2024+b),P=(a,b,c=1)=>{let d=new Date(a,b,1),e=new Date(a,b+1,0).getDate(),f=0;for(let a=1;a<=e;a++){d.setDate(a);let b=d.getDay();1===c?b>=1&&b<=5&&f++:b>=0&&b<=4&&f++}return f},Q=(a,b)=>(b-2024)*12+a,R=a=>({month:a%12,year:2024+Math.floor(a/12)}),S=(p=Q(A,C),Math.max(1,Q(E,G)-p+1)),T=(()=>{let a=Q(A,C),b=Q(E,G),c=a+12*I,d=Math.min(c+12,b+1),e=[];for(let a=c;a<d;a++){let{month:b,year:c}=R(a);e.push({month:b,year:c,displayName:`${N[b].slice(0,3)} ${c.toString().slice(-2)}`,globalIndex:a})}return e})(),U=Math.ceil(S/12);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-wrap gap-4 items-center",children:[a.map(c=>{var e;let f,g,h=(f=parseInt((e=c.color).slice(1,3),16),g=parseInt(e.slice(3,5),16),(299*f+587*g+114*parseInt(e.slice(5,7),16))/1e3>128?"#000":"#fff");return(0,b.jsxs)("div",{className:`flex items-center justify-between px-3 py-1.5 rounded border border-border cursor-pointer hover:opacity-80 transition-opacity w-32 h-8 ${m===c.id?"ring-2 ring-offset-2 ring-blue-500":""}`,style:{backgroundColor:c.color,color:h},onClick:()=>{l&&l(m===c.id?null:c.id)},children:[(0,b.jsx)("span",{className:"text-xs font-medium truncate flex-1",children:c.name}),M&&(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),(b=>{t(b);let c=a.find(a=>a.id===b);if(c){v(c.name),x(c.color),B(c.startMonth??0),D(c.startYear??2024),F(c.endMonth??0),H(c.endYear??2024),L(c.allocationMode??"percentage"),J(0);let a=d.filter(a=>a.projectId===b),e=new Map;a.forEach(a=>{let b=a.name||"Unnamed Position";e.has(b)||e.set(b,{id:`${b}-${Date.now()}`,name:b,projectTask:a.projectTask,budgets:{}});let d=e.get(b),f="days"===c.allocationMode&&a.days?a.days:a.percentage;d.budgets[a.monthIndex]=f}),z(Array.from(e.values()))}})(c.id)},className:"px-1.5 py-0.5 text-[10px] bg-white/20 rounded hover:bg-white/30 transition-colors flex-shrink-0",style:{color:h},children:"Edit"})]},c.id)}),M&&(0,b.jsx)("button",{onClick:()=>r(!0),className:"px-4 py-2 bg-primary text-primary-foreground rounded font-medium hover:bg-primary/90 transition-colors text-sm",children:"+ New Project"})]}),(q||s)&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-card p-6 rounded-lg border border-border shadow-lg w-full h-full mx-4 overflow-y-auto",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-foreground mb-4",children:s?"Edit Project":"Create New Project"}),(0,b.jsxs)("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"Project Name"}),(0,b.jsx)("input",{type:"text",value:u,onChange:a=>v(a.target.value),className:"w-full px-3 py-2 border border-border rounded text-foreground bg-card",placeholder:"Enter project name",disabled:!M,autoFocus:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"Project Color"}),(0,b.jsx)("div",{className:"flex gap-2 flex-wrap",children:["#3B82F6","#10B981","#F59E0B","#8B5CF6","#EC4899","#06B6D4","#EF4444","#14B8A6"].map(a=>(0,b.jsx)("button",{onClick:()=>{console.log("[v0] Color picker clicked, setting color to:",a),x(a)},className:`w-8 h-8 rounded transition-all ${w===a?"ring-2 ring-offset-2 ring-primary":"hover:opacity-80"}`,style:{backgroundColor:a},title:a},a))})]})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"Allocation Mode"}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,b.jsx)("input",{type:"radio",name:"allocationMode",value:"percentage",checked:"percentage"===K,onChange:a=>L("percentage"),className:"text-primary",disabled:!M}),(0,b.jsx)("span",{className:"text-sm",children:"% Allocation"})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,b.jsx)("input",{type:"radio",name:"allocationMode",value:"days",checked:"days"===K,onChange:a=>L("days"),className:"text-primary",disabled:!M}),(0,b.jsx)("span",{className:"text-sm",children:"Day Allocation"})]})]})]}),(0,b.jsxs)("div",{className:"mb-6 grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"Start Month"}),(0,b.jsx)("select",{value:A,onChange:a=>B(Number(a.target.value)),className:"border border-border rounded px-3 py-2 w-full text-sm bg-background text-foreground",disabled:!M,children:N.map((a,c)=>(0,b.jsx)("option",{value:c,children:a},c))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"Start Year"}),(0,b.jsx)("select",{value:C,onChange:a=>D(Number(a.target.value)),className:"border border-border rounded px-3 py-2 w-full text-sm bg-background text-foreground",disabled:!M,children:O.map(a=>(0,b.jsx)("option",{value:a,children:a},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"End Month"}),(0,b.jsx)("select",{value:E,onChange:a=>F(Number(a.target.value)),className:"border border-border rounded px-3 py-2 w-full text-sm bg-background text-foreground",disabled:!M,children:N.map((a,c)=>(0,b.jsx)("option",{value:c,children:a},c))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"End Year"}),(0,b.jsx)("select",{value:G,onChange:a=>H(Number(a.target.value)),className:"border border-border rounded px-3 py-2 w-full text-sm bg-background text-foreground",disabled:!M,children:O.map(a=>(0,b.jsx)("option",{value:a,children:a},a))})]})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,b.jsxs)("label",{className:"text-xs font-medium text-muted-foreground",children:["Positions by Month (","days"===K?"Days":"%",") - Page ",I+1," of ",U]}),(0,b.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,b.jsx)("button",{onClick:()=>J(Math.max(0,I-1)),disabled:0===I,className:"px-3 py-1 text-xs bg-primary text-primary-foreground rounded hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"â† Prev 12"}),(0,b.jsx)("button",{onClick:()=>J(Math.min(U-1,I+1)),disabled:I>=U-1,className:"px-3 py-1 text-xs bg-primary text-primary-foreground rounded hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Next 12 â†’"}),(0,b.jsx)("button",{onClick:()=>{z([...y,{id:`pos-${Date.now()}`,name:"New Position",budgets:{}}])},className:"px-3 py-1 text-xs bg-primary text-primary-foreground rounded hover:bg-primary/90 transition-colors",disabled:!M,children:"+ Add Position"}),(0,b.jsx)("button",{onClick:()=>{if(0===y.length)return void alert("No positions to export");let a="",b=["Project Task","Position Name",...T.map(a=>a.displayName)];a+=b.join(",")+"\n",y.filter(a=>""!==a.name.trim()).forEach(b=>{let c=[b.projectTask||"",b.name];T.forEach(a=>{let d=b.budgets[a.globalIndex]||0;c.push(d.toString())}),a+=c.join(",")+"\n"});let c=new Blob([a],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),e=URL.createObjectURL(c),f=u||"Project",g=`${f}-positions-${K}-${new Date().toISOString().split("T")[0]}.csv`;d.setAttribute("href",e),d.setAttribute("download",g),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)},className:"px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition-colors",title:"Export positions to Excel",children:"ðŸ“¥ Export"}),(0,b.jsx)("button",{onClick:()=>document.getElementById("excel-import-input")?.click(),className:"px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",title:"Import positions from Excel",disabled:!M,children:"ðŸ“¤ Import"}),(0,b.jsx)("input",{id:"excel-import-input",type:"file",accept:".xlsx,.xls,.csv",onChange:a=>{let b=a.target.files?.[0];if(!b)return;let c=new FileReader;c.onload=a=>{try{let b=(a.target?.result).split("\n").filter(a=>a.trim());if(b.length<2)return void alert("File must contain at least a header row and one data row");b[0].split(",").map(a=>a.trim()).slice(2);let c=[];for(let a=1;a<b.length;a++){let d=b[a].split(",").map(a=>a.trim());if(d.length<3||!d[1])continue;let e=d[0],f=d[1],g={};d.slice(2).forEach((a,b)=>{if(b<T.length){let c=parseFloat(a)||0;g[T[b].globalIndex]=c}}),c.push({id:`imported-${f}-${Date.now()}-${a}`,name:f,projectTask:e,budgets:g})}if(c.length>0){if(y.some(a=>""!==a.name.trim())&&!confirm(`Import will replace existing positions with ${c.length} imported positions. Continue?`))return;z(c),alert(`Successfully imported ${c.length} positions`)}else alert("No valid position data found in file")}catch(a){console.error("Import error:",a),alert("Error importing file. Please check the file format and try again.")}},c.onerror=()=>{alert("Error reading file")},c.readAsText(b),a.target&&(a.target.value="")},style:{display:"none"},disabled:!M})]})]}),(0,b.jsx)("div",{className:"border border-border rounded overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-[10px]",children:[(0,b.jsx)("thead",{className:"bg-muted border-b border-border",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-muted-foreground min-w-20",children:"Project Task"}),(0,b.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-muted-foreground min-w-40",children:"Position Name"}),T.map(a=>(0,b.jsx)("th",{className:"px-4 py-2 text-center font-semibold text-muted-foreground min-w-20",children:a.displayName},a.globalIndex)),(0,b.jsx)("th",{className:"px-4 py-2 text-center font-semibold text-muted-foreground w-10",children:"Action"})]})}),(0,b.jsx)("tbody",{children:0===y.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:T.length+3,className:"px-4 py-8 text-center text-muted-foreground",children:'No positions yet. Click "Add Position" to create one.'})}):y.map(a=>(0,b.jsxs)("tr",{className:"border-t border-border hover:bg-muted/50",children:[(0,b.jsx)("td",{className:"px-4 py-2 border-r border-border",children:(0,b.jsx)("input",{type:"text",value:a.projectTask||"",onChange:b=>{var c,d;return c=a.id,d=b.target.value,void z(y.map(a=>a.id===c?{...a,projectTask:d}:a))},className:"w-full px-2 py-1 border border-border rounded text-foreground bg-card",placeholder:"e.g., 01.03.01",disabled:!M})}),(0,b.jsx)("td",{className:"px-4 py-2 border-r border-border",children:(0,b.jsx)("input",{type:"text",value:a.name,onChange:b=>{var c,d;return c=a.id,d=b.target.value,void z(y.map(a=>a.id===c?{...a,name:d}:a))},className:"w-full px-2 py-1 border border-border rounded text-foreground bg-card",placeholder:"e.g., Senior Developer",disabled:!M})}),T.map(c=>(0,b.jsx)("td",{className:"px-4 py-2 border-r border-border last:border-r-0 bg-background",children:(0,b.jsx)("input",{type:"number",min:"0",max:"days"===K?P(c.year,c.month,1):999,value:a.budgets[c.globalIndex]||"",onChange:b=>{var d,e,f;return d=a.id,e=c.globalIndex,f=b.target.value?Number(b.target.value):0,void z(y.map(a=>a.id===d?{...a,budgets:{...a.budgets,[e]:f}}:a))},className:"w-full px-2 py-1 text-center border border-border rounded text-foreground bg-card",placeholder:"days"===K?`0-${P(c.year,c.month,1)} days`:"0%",disabled:!M})},c.globalIndex)),(0,b.jsx)("td",{className:"px-4 py-2 text-center",children:(0,b.jsx)("button",{onClick:()=>{var b;return b=a.id,void z(y.filter(a=>a.id!==b))},className:"px-2 py-1 text-xs bg-destructive text-destructive-foreground rounded hover:bg-destructive/90 transition-colors",disabled:!M,children:"âœ•"})})]},a.id))})]})})]}),(0,b.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,b.jsx)("button",{onClick:()=>{r(!1),t(null),v(""),x("#3B82F6"),z([]),B(0),D(2024),F(0),H(2024),J(0),L("percentage")},className:"px-4 py-2 bg-muted text-muted-foreground rounded font-medium hover:bg-muted/80 transition-colors text-sm",children:"Cancel"}),s&&(0,b.jsx)("button",{onClick:()=>{window.confirm("Are you sure you want to delete this project? All positions will be removed.")&&(j(s),t(null),v(""),x("#3B82F6"),z([]),B(0),D(2024),F(0),H(2024),J(0),L("percentage"))},className:"px-4 py-2 bg-destructive text-black rounded font-medium hover:bg-destructive/90 transition-colors text-sm",children:"Delete Project"}),(0,b.jsx)("button",{onClick:s?()=>{if(!s||!u.trim())return;console.log("[v0] Saving project with dates:",{projectId:s,startMonth:A,startYear:C,endMonth:E,endYear:G}),console.log("[v0] Saving project with color:",{projectId:s,selectedColor:w}),console.log("[v0] About to call onUpdateProject with:",{projectId:s,name:u,color:w,startMonth:A,startYear:C,endMonth:E,endYear:G});let b=d.filter(a=>a.projectId===s),c=[];y.forEach(d=>{T.forEach(e=>{let f=d.budgets[e.globalIndex]||0;if(f>0){let g=b.find(a=>a.monthIndex===e.globalIndex&&a.name===d.name),h=a.find(a=>a.id===s),i=h?.allocationMode||"percentage",j={id:g?.id||`pos-${s}-${d.id}-${e.globalIndex}`,projectId:s,monthIndex:e.globalIndex,percentage:"days"===i?f/P(e.year,e.month,1)*100:f,allocated:g?.allocated||0,name:d.name,projectTask:d.projectTask,days:"days"===i?f:void 0};c.push(j)}})}),k([...d.filter(a=>a.projectId!==s),...c]),n&&n(s,c.map(a=>a.id)),i(s,{name:u,color:w,startMonth:A,startYear:C,endMonth:E,endYear:G,allocationMode:K}),t(null),v(""),x("#3B82F6"),z([]),B(0),D(2024),F(0),H(2024),J(0),L("percentage")}:()=>{if(!u.trim())return;console.log("[DEBUG] Creating project with dates:",{projectStartMonth:A,projectStartYear:C,projectEndMonth:E,projectEndYear:G});let a={id:`proj-${Date.now()}`,name:u,color:w,startMonth:A,startYear:C,endMonth:E,endYear:G,allocationMode:K};console.log("[DEBUG] Project object being created:",a),h(a);let b=[];Q(A,C),Q(E,G),y.forEach(c=>{T.forEach((d,e)=>{let f=c.budgets[d.globalIndex]||0;if(f>0){let e={id:`pos-${a.id}-${c.id}-${d.globalIndex}`,projectId:a.id,monthIndex:d.globalIndex,percentage:"days"===K?f/P(d.year,d.month,1)*100:f,allocated:0,name:c.name,projectTask:c.projectTask,days:"days"===K?f:void 0};b.push(e)}})}),b.length>0&&k([...d,...b]),v(""),x("#3B82F6"),z([]),B(0),D(2024),F(0),H(2024),J(0),L("percentage"),r(!1)},className:"px-4 py-2 bg-primary text-primary-foreground rounded font-medium hover:bg-primary/90 transition-colors text-sm",disabled:!M,children:s?"Save Changes":"Create Project"})]})]})})]})}var g=a.i(77577);function h({isOpen:a,onClose:e}){let[f,h]=(0,c.useState)((0,g.getSystemUsers)()),[i,j]=(0,c.useState)({email:"",name:"",password:"",role:"editor"}),[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)({email:"",name:"",password:"",role:"editor"}),[q,r]=(0,c.useState)(()=>[]),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(!1);c.default.useEffect(()=>{},[q]);let E=()=>{let a=(0,g.getSystemUsers)();console.log("All users in system:",a),h(a)};return a?(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Settings"}),(0,b.jsx)(d.Button,{onClick:e,variant:"outline",size:"sm",children:"Ã—"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[m&&(0,b.jsxs)("div",{className:"p-4 border rounded-lg bg-blue-50 space-y-3",children:[(0,b.jsxs)("h4",{className:"font-medium text-sm",children:["Edit User: ",m.name]}),(0,b.jsx)("input",{type:"email",placeholder:"Email",value:o.email,onChange:a=>p({...o,email:a.target.value}),className:"w-full px-3 py-2 border rounded text-sm"}),(0,b.jsx)("input",{type:"text",placeholder:"Name",value:o.name,onChange:a=>p({...o,name:a.target.value}),className:"w-full px-3 py-2 border rounded text-sm"}),(0,b.jsx)("input",{type:"password",placeholder:"Password (leave empty to keep current)",value:o.password,onChange:a=>p({...o,password:a.target.value}),className:"w-full px-3 py-2 border rounded text-sm"}),(0,b.jsxs)("select",{value:o.role,onChange:a=>p({...o,role:a.target.value}),className:"w-full px-3 py-2 border rounded text-sm",children:[(0,b.jsx)("option",{value:"admin",children:"Admin"}),(0,b.jsx)("option",{value:"editor",children:"Editor"}),(0,b.jsx)("option",{value:"viewer",children:"Viewer"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(d.Button,{onClick:()=>{m&&o.email&&o.name&&((0,g.updateSystemUser)(m.id,{email:o.email,name:o.name,password:o.password||m.password,role:o.role}),n(null),p({email:"",name:"",password:"",role:"editor"}),E())},size:"sm",children:"Save Changes"}),(0,b.jsx)(d.Button,{onClick:()=>{n(null),p({email:"",name:"",password:"",role:"editor"})},variant:"outline",size:"sm",children:"Cancel"})]})]}),k&&(0,b.jsxs)("div",{className:"p-4 border rounded-lg bg-gray-50 space-y-3",children:[(0,b.jsx)("input",{type:"email",placeholder:"Email",value:i.email,onChange:a=>j({...i,email:a.target.value}),className:"w-full px-3 py-2 border rounded text-sm"}),(0,b.jsx)("input",{type:"text",placeholder:"Name",value:i.name,onChange:a=>j({...i,name:a.target.value}),className:"w-full px-3 py-2 border rounded text-sm"}),(0,b.jsx)("input",{type:"password",placeholder:"Password",value:i.password,onChange:a=>j({...i,password:a.target.value}),className:"w-full px-3 py-2 border rounded text-sm"}),(0,b.jsxs)("select",{value:i.role,onChange:a=>j({...i,role:a.target.value}),className:"w-full px-3 py-2 border rounded text-sm",children:[(0,b.jsx)("option",{value:"admin",children:"Admin"}),(0,b.jsx)("option",{value:"editor",children:"Editor"}),(0,b.jsx)("option",{value:"viewer",children:"Viewer"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(d.Button,{onClick:()=>{i.email&&i.name&&i.password&&(console.log("Adding user:",i),console.log("User added successfully:",(0,g.addSystemUser)({email:i.email,name:i.name,password:i.password,role:i.role,isActive:!0})),j({email:"",name:"",password:"",role:"editor"}),l(!1),E())},size:"sm",children:"Add User"}),(0,b.jsx)(d.Button,{onClick:()=>l(!1),variant:"outline",size:"sm",children:"Cancel"})]})]}),!k&&(0,b.jsx)(d.Button,{onClick:()=>l(!0),variant:"outline",size:"sm",children:"+ Add New User"}),(0,b.jsx)("div",{className:"space-y-2",children:f.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:a.name}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:a.email}),(0,b.jsxs)("div",{className:"text-xs",children:[(0,b.jsx)("span",{className:`px-2 py-1 rounded text-xs ${"admin"===a.role?"bg-red-100 text-red-700":"editor"===a.role?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:a.role}),(0,b.jsx)("span",{className:`ml-2 px-2 py-1 rounded text-xs ${a.isActive?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:a.isActive?"Active":"Inactive"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(d.Button,{onClick:()=>{n(a),p({email:a.email,name:a.name,password:a.password,role:a.role})},variant:"outline",size:"sm",children:"Edit"}),(0,b.jsx)(d.Button,{onClick:()=>{var b,c;return b=a.id,c=!a.isActive,void((0,g.updateSystemUser)(b,{isActive:c}),E())},variant:"outline",size:"sm",children:a.isActive?"Deactivate":"Activate"}),"admin@sola.com"!==a.email&&(0,b.jsx)(d.Button,{onClick:()=>{var b;return b=a.id,void(confirm("Are you sure you want to delete this user?")&&((0,g.deleteSystemUser)(b),E()))},variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",children:"Delete"})]})]},a.id))})]}),(0,b.jsxs)("div",{className:"border-t pt-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold text-gray-700",children:"Entity Management"}),(0,b.jsx)(d.Button,{onClick:()=>B(!A),variant:"outline",size:"sm",children:A?"Hide":"Show"})]}),A&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"border rounded-lg p-3 bg-gray-50",children:[(0,b.jsx)("h5",{className:"text-sm font-medium mb-2",children:"Add New Entity"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsx)("input",{type:"text",placeholder:"Entity Name",value:s,onChange:a=>t(a.target.value),className:"px-2 py-1 border rounded text-sm"}),(0,b.jsx)("input",{type:"text",placeholder:"Currency Code",value:u,onChange:a=>v(a.target.value),className:"px-2 py-1 border rounded text-sm"}),(0,b.jsx)("input",{type:"text",placeholder:"Tax Account",value:w,onChange:a=>x(a.target.value),className:"px-2 py-1 border rounded text-sm"}),(0,b.jsx)("input",{type:"text",placeholder:"SS Account",value:y,onChange:a=>z(a.target.value),className:"px-2 py-1 border rounded text-sm"})]}),(0,b.jsx)(d.Button,{onClick:()=>{if(!s.trim()||!u.trim())return;let a={id:`entity-${Date.now()}`,name:s.trim(),currencyCode:u.trim(),taxAccount:w.trim(),ssAccount:y.trim()};r(b=>[...b,a]),t(""),v(""),x(""),z("")},size:"sm",className:"mt-2",children:"Add Entity"})]}),q.length>0&&(0,b.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,b.jsx)("h5",{className:"text-sm font-medium mb-2",children:"Existing Entities"}),(0,b.jsx)("div",{className:"space-y-2",children:q.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded text-xs bg-gray-50",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.name}),(0,b.jsxs)("div",{className:"text-gray-600",children:["Currency: ",a.currencyCode," | Tax: ",a.taxAccount," | SS: ",a.ssAccount]})]}),(0,b.jsx)(d.Button,{onClick:()=>{var b;return b=a.id,void(confirm("Are you sure you want to delete this entity?")&&r(a=>a.filter(a=>a.id!==b)))},variant:"destructive",size:"sm",children:"Delete"})]},a.id))})]})]})]}),(0,b.jsxs)("div",{className:"border-t pt-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold text-gray-700",children:"Backup Management"}),(0,b.jsx)(d.Button,{onClick:()=>D(!C),variant:"outline",size:"sm",children:C?"Hide":"Show"})]}),C&&(0,b.jsx)("div",{className:"space-y-3",children:(0,b.jsxs)("div",{className:"border rounded-lg p-3 bg-gray-50",children:[(0,b.jsx)("h5",{className:"text-sm font-medium mb-2",children:"Data Backup & Restore"}),(0,b.jsx)("p",{className:"text-xs text-gray-600 mb-3",children:"Create backups of all your data (projects, users, entities, allocations) and restore them when needed."}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded bg-white",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:"Create Backup"}),(0,b.jsx)("div",{className:"text-xs text-gray-600",children:"Download all data as JSON file"})]}),(0,b.jsx)(d.Button,{onClick:()=>{},size:"sm",children:"Create Backup"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded bg-white",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:"Import Backup"}),(0,b.jsx)("div",{className:"text-xs text-gray-600",children:"Restore data from backup file"})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)("input",{type:"file",accept:".json",onChange:a=>{let b=a.target.files?.[0];if(!b)return;let c=new FileReader;c.onload=a=>{try{let b=a.target?.result,c=JSON.parse(b);if(!c.data||"object"!=typeof c.data)throw Error("Invalid backup file structure");if(confirm("This will overwrite all current data. Are you sure you want to continue?")){let a=c.data;(0,g.setCurrentUserData)({projects:a.projects||[],users:a.users||[],allocations:a.allocations||[],positions:a.positions||[],entities:a.entities||[],startMonth:a.startMonth,startYear:a.startYear,systemUsers:a.systemUsers||[]}),r(a.entities||[]),E(),alert("Backup imported successfully! Please refresh the page to see all changes.")}}catch(a){alert("Error importing backup: "+a.message)}},c.readAsText(b),a.target.value=""},className:"text-xs file:mr-2 file:py-1 file:px-2 file:rounded file:border-0 file:text-xs file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})})]})]}),(0,b.jsx)("div",{className:"mt-3 p-2 bg-yellow-50 border border-yellow-200 rounded",children:(0,b.jsxs)("p",{className:"text-xs text-yellow-800",children:[(0,b.jsx)("strong",{children:"Warning:"})," Importing a backup will overwrite all current data. Make sure to create a backup before importing."]})})]})})]})]})}):null}let i=Array.from({length:10},(a,b)=>2024+b);function j(){let[a,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(()=>[]),[o,p]=(0,c.useState)(()=>[{id:"1",name:"John Doe",department:"Engineering"},{id:"2",name:"Jane Smith",department:"Design"},{id:"3",name:"Bob Johnson",department:"Product"}]),[q,r]=(0,c.useState)(()=>[]),[s,t]=(0,c.useState)(()=>[]);(0,c.useEffect)(()=>{let a=(0,g.getCurrentUser)(),b=(0,g.getCurrentSystemUser)();a&&b?(j(a),l(b.role)):window.location.href="/login"},[]),(0,c.useEffect)(()=>{},[m,a]),(0,c.useEffect)(()=>{},[o,a]),(0,c.useEffect)(()=>{},[q,a]),(0,c.useEffect)(()=>{},[s,a]);let[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(()=>0),[y,z]=(0,c.useState)(()=>2024);(0,c.useEffect)(()=>{},[w,y,a]);let[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(0),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(null),[M,N]=(0,c.useState)(""),[O,P]=(0,c.useState)(""),[Q,R]=(0,c.useState)(""),[S,T]=(0,c.useState)(""),[U,V]=(0,c.useState)(""),[W,X]=(0,c.useState)(""),[Y,Z]=(0,c.useState)("mon-fri"),[$,_]=(0,c.useState)(null),[aa,ab]=(0,c.useState)(null),[ac,ad]=(0,c.useState)(!1),[ae,af]=(0,c.useState)(!1),[ag,ah]=(0,c.useState)("percentage"),[ai,aj]=(0,c.useState)(!1),[ak,al]=(0,c.useState)(null),[am,an]=(0,c.useState)(!1),[ao,ap]=(0,c.useState)(new Date().getFullYear()),[aq,ar]=(0,c.useState)({}),[as,at]=(0,c.useState)(null),[au,av]=(0,c.useState)(null),[aw,ax]=(0,c.useState)(()=>[]),ay="admin"===k,az=m.filter(a=>{if(console.log("[DEBUG] Checking project:",a.name),console.log("[DEBUG] Project dates:",{startMonth:a.startMonth,startYear:a.startYear,endMonth:a.endMonth,endYear:a.endYear,hasEndMonth:!!a.endMonth,hasEndYear:!!a.endYear,endMonthType:typeof a.endMonth,endYearType:typeof a.endYear}),!a.endMonth||!a.endYear)return console.log("[DEBUG] Project has no end date, including - endMonth:",a.endMonth,"endYear:",a.endYear),!0;let b=a.startYear||2024,c=a.endYear||2024;console.log("[DEBUG] Using years:",{projectStartYear:b,projectEndYear:c});let d=new Date(b,a.startMonth||0,1),e=new Date(c,a.endMonth,1),f=new Date(y,w,1),g=new Date(y,w+11,1);console.log("[DEBUG] Date comparison:",{projectStartDate:d.toISOString().split("T")[0],projectEndDate:e.toISOString().split("T")[0],staffStartDate:f.toISOString().split("T")[0],staffEndDate:g.toISOString().split("T")[0]});let h=d<=g&&e>=f;return console.log("[DEBUG] Overlap result:",{projectStartBeforeStaffEnd:d<=g,projectEndAfterStaffStart:e>=f,overlaps:h}),h}),aA=["January","February","March","April","May","June","July","August","September","October","November","December"],aB=Array.from({length:12},(a,b)=>{let c=new Date(y,w+b,1),d=c.getMonth(),e=c.getFullYear();return{month:d,year:e,globalIndex:(e-2024)*12+d,display:`${aA[d].slice(0,3).toUpperCase()} ${String(e).slice(-2)}`}}),aC=(a,b)=>{let c=o.find(b=>b.id===a);if(!c?.endDate)return!1;let d=new Date(c.endDate);if(Number.isNaN(d.getTime()))return!1;let e=d.getMonth();return b>(d.getFullYear()-2024)*12+e},aD=(a,b)=>{let c=o.find(b=>b.id===a);if(!c?.startDate)return!0;let d=new Date(c.startDate);if(Number.isNaN(d.getTime()))return!0;let e=d.getMonth();return b>=(d.getFullYear()-2024)*12+e},aE=(a,b,c=1)=>{let d=new Date(a,b,1),e=new Date(a,b+1,0).getDate(),f=0;for(let a=1;a<=e;a++){d.setDate(a);let b=d.getDay();1===c?b>=1&&b<=5&&f++:b>=0&&b<=4&&f++}return f},aF=(a,b,c)=>{let d=o.find(b=>b.id===a);return d?Math.round(c/100*aE(Math.floor(b/12)+2024,b%12,+("mon-fri"===(d.workDays||"mon-fri")))):0},aG=(a,b,c)=>{if(aa&&null!==$){let d=m.find(b=>b.id===a),e=d?.positions?.find(a=>a.monthIndex===$&&a.name===b);if(!e||!e.percentage)return;let f=q.filter(c=>c.projectId===a&&c.monthIndex===$&&(c.positionId===e.id||c.positionName===b)).reduce((a,b)=>a+(b.percentage||0),0),g=Math.max(0,e.percentage-f);if(g<=0)return;let h=c?Math.min(c,g):g,i={id:`alloc-${Date.now()}`,userId:aa,projectId:a,monthIndex:$,percentage:h,positionId:e?.id,positionName:b};r(a=>[...a,i]),n(c=>c.map(c=>c.id===a?{...c,positions:c.positions?.map(a=>a.monthIndex===$&&a.name===b?{...a,allocated:(a.allocated||0)+h}:a)}:c)),ad(!1),at(null),ar({}),ab(null),_(null)}},aH=a=>{let b=q.find(b=>b.id===a);b&&n(a=>a.map(a=>a.id===b.projectId?{...a,positions:a.positions?.map(a=>a.monthIndex===b.monthIndex&&a.name===b.positionName?{...a,allocated:Math.max(0,(a.allocated||0)-1)}:a)}:a)),r(b=>b.filter(b=>b.id!==a))},aI=(a,b)=>{r(c=>c.map(c=>c.id===a?{...c,percentage:b}:c)),B(null),D(0)},aJ=(y-2024)*12+w,aK=aJ+11,aL=o.filter(a=>{if(a.endDate){let b=new Date(a.endDate);if(!Number.isNaN(b.getTime())){let a=b.getMonth();if((b.getFullYear()-2024)*12+a<aJ)return!1}}if(a.startDate){let b=new Date(a.startDate);if(!Number.isNaN(b.getTime())){let a=b.getMonth();if((b.getFullYear()-2024)*12+a>aK)return!1}}return!0}),aM=Array.from((au?aL.filter(a=>q.some(b=>b.userId===a.id&&b.projectId===au)):aL).reduce((a,b)=>(a.has(b.department)||a.set(b.department,[]),a.get(b.department).push(b),a),new Map)).map(([a,b])=>({department:a,users:b.sort((a,b)=>a.name.localeCompare(b.name))})).sort((a,b)=>a.department.localeCompare(b.department));return(0,b.jsxs)("div",{className:"space-y-4 p-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start gap-4",children:[(0,b.jsx)("div",{children:("admin"===k||"editor"===k||"viewer"===k)&&(0,b.jsx)(f,{projects:az,positions:az.flatMap(a=>a.positions||[]),months:aA,startMonth:w,startYear:y,onAddProject:a=>{n(b=>[...b,a])},onUpdateProject:(a,b)=>{console.log("[v0] updateProject called:",{projectId:a,updates:b}),console.trace("[v0] updateProject call stack"),n(c=>{let d=c.find(b=>b.id===a);if(d&&Object.entries(b).every(([a,b])=>d[a]===b))return console.log("[v0] Skipping update: no actual changes detected"),c;let e=c.map(c=>c.id===a?{...c,...b}:c);return console.log("[v0] projects after update:",e),e})},onDeleteProject:a=>{n(b=>b.filter(b=>b.id!==a)),r(b=>b.filter(b=>b.projectId!==a))},onUpdatePositions:a=>{n(m.map(b=>({...b,positions:a.filter(a=>a.projectId===b.id)}))),r(q.map(b=>{let c=a.find(a=>a.projectId===b.projectId&&a.monthIndex===b.monthIndex&&a.name===b.positionName);return c&&b.percentage>c.percentage?{...b,percentage:c.percentage}:b}))},onProjectSelect:av,selectedProjectId:au,onCleanupAllocations:(a,b)=>{r(c=>{let d=c.filter(c=>!!(c.projectId!==a||c.positionId&&b.includes(c.positionId))),e=c.filter(c=>c.projectId===a&&(!c.positionId||!b.includes(c.positionId)));return e.length>0&&n(b=>b.map(b=>b.id===a?{...b,positions:b.positions?.map(a=>{let b=e.filter(b=>b.positionId===a.id).reduce((a,b)=>a+(b.percentage||0),0);return{...a,allocated:Math.max(0,(a.allocated||0)-b)}})}:b)),d})},currentUserRole:k})}),(0,b.jsxs)("div",{className:"flex gap-4 items-end",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"block text-sm font-medium",children:"Starting Month"}),(0,b.jsx)("select",{value:w,onChange:a=>x(Number.parseInt(a.target.value)),className:"border rounded px-2 py-1",children:aA.map((a,c)=>(0,b.jsx)("option",{value:c,children:a},a))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"block text-sm font-medium",children:"Starting Year"}),(0,b.jsx)("select",{value:y,onChange:a=>z(Number.parseInt(a.target.value)),className:"border rounded px-2 py-1",children:i.map(a=>(0,b.jsx)("option",{value:a,children:a},a))})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2 rounded-full",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[au&&(0,b.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:[(0,b.jsxs)("span",{children:["Filtered by: ",m.find(a=>a.id===au)?.name]}),(0,b.jsx)("button",{onClick:()=>av(null),className:"text-blue-600 hover:text-blue-800 font-bold",children:"Ã—"})]}),("admin"===k||"editor"===k)&&(0,b.jsx)(d.Button,{onClick:()=>{L(null),N(""),P(""),R(""),T(""),V(""),X(""),Z("mon-fri"),J(!0)},variant:"default",size:"sm",className:"bg-blue-900 hover:bg-blue-800 text-white",children:"+ New Staff"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"View:"}),(0,b.jsxs)("div",{className:"flex border rounded overflow-hidden",children:[(0,b.jsx)("button",{onClick:()=>ah("percentage"),className:`px-3 py-1 text-sm font-medium transition-colors ${"percentage"===ag?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"% View"}),(0,b.jsx)("button",{onClick:()=>ah("days"),className:`px-3 py-1 text-sm font-medium transition-colors ${"days"===ag?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"Days View"})]})]}),(0,b.jsx)("button",{onClick:()=>{let a="",b=["Staff",...aB.map(a=>a.display)];a+=b.join(",")+"\n",aM.forEach(b=>{a+=`${b.department},
`,b.users.forEach(b=>{let c=[b.name];aB.forEach(a=>{let d=q.filter(c=>c.userId===b.id&&c.monthIndex===a.globalIndex);if(d.length>0){let e,f=d.reduce((a,b)=>a+(b.percentage||0),0);"days"===ag?(e=aF(b.id,a.globalIndex,f),c.push(`${e} days`)):(e=Math.round(f),c.push(`${e}%`))}else aD(b.id,a.globalIndex)?aC(b.id,a.globalIndex)?c.push("ended"):c.push(""):c.push("not started")}),a+=c.join(",")+"\n"})});let c=new Blob([a],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),e=URL.createObjectURL(c),f=`staff-allocation-${ag}-${new Date().toISOString().split("T")[0]}.csv`;d.setAttribute("href",e),d.setAttribute("download",f),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)},className:"px-3 py-1 text-sm bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors ml-4",children:"Export to Excel"}),(0,b.jsx)("button",{onClick:()=>an(!0),className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700 transition-colors ml-2",title:"Show Project Gantt Chart",children:"ðŸ“Š Gantt Chart"})]}),(0,b.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,b.jsxs)("div",{className:"text-right mr-4",children:[(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Current User"}),(0,b.jsx)("div",{className:"font-medium",children:a}),(0,b.jsx)("div",{className:"text-xs text-gray-500 capitalize",children:k})]}),"admin"===k&&(0,b.jsxs)(d.Button,{onClick:()=>af(!0),variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),"Users"]}),(0,b.jsxs)(d.Button,{onClick:()=>{(0,g.getCurrentUser)()&&(0,g.setCurrentUserData)({startMonth:w,startYear:y}),(0,g.clearCurrentUser)(),window.location.href="/login"},variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Logout"]})]})]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,b.jsxs)("thead",{children:[(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"border border-gray-300 p-2 bg-gray-100 w-42",children:"Staff"}),aB.map((a,c)=>{let d=aE(a.year,a.month,1),e=aE(a.year,a.month,0);return(0,b.jsx)("th",{className:"border border-gray-300 p-2 bg-gray-100 w-32 cursor-pointer hover:bg-gray-200 text-sm",onClick:()=>{var b;al({year:Math.floor((b=a.globalIndex)/12)+2024,month:b%12,globalIndex:b}),aj(!0)},children:(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("div",{children:a.display}),(0,b.jsxs)("div",{className:"text-[10px] text-gray-600 mt-1",children:[(0,b.jsxs)("div",{children:["Mon-Fri: ",d]}),(0,b.jsxs)("div",{children:["Sun-Thu: ",e]})]})]})},c)})]}),(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"border border-gray-300 bg-gray-50 w-42 text-xs text-muted-foreground",children:"Unallocated"}),aB.map(a=>{let c=az.flatMap(b=>(b.positions?.filter(b=>b.monthIndex===a.globalIndex)||[]).map(c=>{let d,e,f=q.filter(d=>d.projectId===b.id&&d.monthIndex===a.globalIndex&&d.positionId===c.id).reduce((a,b)=>a+(b.percentage||0),0),g=Math.max(0,c.percentage-f);if(g<=0)return null;if("days"===ag){let b=Math.round(g/100*aE(a.year,a.month,1));d=b,e=`${b} days`}else d=Math.round(g),e=`${d}%`;return{projectId:b.id,projectName:b.name,projectColor:b.color,positionId:c.id,positionName:c.name||"Position",percentage:g,displayValue:d,displayText:e}}).filter(a=>null!=a));return(0,b.jsx)("td",{className:"border border-gray-300 bg-gray-50 p-1 align-top",style:{verticalAlign:"top"},children:(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:c.map(a=>(0,b.jsx)("div",{className:"flex items-center h-8 rounded overflow-hidden bg-gray-200 text-[9px] text-white",style:{minWidth:"50px",maxWidth:"120px"},title:`${a.projectName} - ${a.positionName} (${a.displayText} unallocated)`,children:(0,b.jsxs)("div",{className:"h-full flex items-center justify-center px-1 text-center leading-tight",style:{backgroundColor:a.projectColor||"#3b82f6",width:"100%"},children:[a.positionName," (",a.displayText,")"]})},`${a.projectId}-${a.positionId}`))})},a.globalIndex)})]})]}),(0,b.jsx)("tbody",{children:aM.map(a=>(0,b.jsxs)(c.default.Fragment,{children:[(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:aB.length+1,className:"border border-gray-300 p-1 font-semibold text-xs text-gray-800 bg-cyan-200",children:a.department})}),a.users.map(a=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"border border-gray-300 p-1 w-42",children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,b.jsx)("span",{className:"text-xs leading-tight",children:a.name}),"admin"===k&&(0,b.jsx)("button",{onClick:()=>{var b;let c;return b=a.id,void((c=o.find(a=>a.id===b))&&(L(b),N(c.name),P(c.department),R(c.entity||""),T(c.vendorAC||""),V(c.startDate||""),X(c.endDate||""),Z(c.workDays||"mon-fri"),J(!0)))},className:"text-blue-600 hover:text-blue-800 text-xs",children:"âœï¸"})]})}),aB.map(c=>(0,b.jsx)(e,{userId:a.id,monthIndex:c.globalIndex,allocations:q.filter(b=>b.userId===a.id&&b.monthIndex===c.globalIndex),project:az.find(a=>a.id===q[0]?.projectId),projects:az,users:o,month:c,userEnded:aC(a.id,c.globalIndex),userNotStarted:!aD(a.id,c.globalIndex),viewMode:ag,getDaysFromPercentage:aF,readOnly:"viewer"===k,onEdit:a=>{B(a);let b=q.find(b=>b.id===a);b&&D(b.percentage)},onSaveEdit:aI,onRemove:aH,onEmptyCellClick:()=>((a,b)=>{if(!ay)return;console.log("[v0] Empty cell clicked:",{userId:a,monthIndex:b,selectedMonth:u});let c=o.find(b=>b.id===a);if(c?.endDate){let a=new Date(c.endDate);if(!Number.isNaN(a.getTime())){let c=a.getMonth();if(b>(a.getFullYear()-2024)*12+c)return}}if(c?.startDate){let a=new Date(c.startDate);if(!Number.isNaN(a.getTime())){let c=a.getMonth();if(b<(a.getFullYear()-2024)*12+c)return}}ab(a),_(b),ad(!0)})(a.id,c.globalIndex)},`${a.id}-${c.globalIndex}`))]},a.id))]},a.department))})]})})]}),I&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg p-6 w-96",children:[(0,b.jsx)("h3",{className:"text-lg font-bold mb-4",children:K?"Edit User":"Add User"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Name"}),(0,b.jsx)("input",{type:"text",value:M,onChange:a=>N(a.target.value),className:"w-full border rounded px-2 py-1",placeholder:"User name"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Department"}),(0,b.jsx)("input",{type:"text",value:O,onChange:a=>P(a.target.value),className:"w-full border rounded px-2 py-1",placeholder:"Department"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Entity"}),(0,b.jsxs)("select",{value:Q,onChange:a=>R(a.target.value),className:"w-full border rounded px-2 py-1",children:[(0,b.jsx)("option",{value:"",children:"Select Entity"}),aw.map(a=>(0,b.jsx)("option",{value:a.name,children:a.name},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Vendor AC"}),(0,b.jsx)("input",{type:"text",value:S,onChange:a=>T(a.target.value),className:"w-full border rounded px-2 py-1",placeholder:"Vendor AC"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Start Date"}),(0,b.jsx)("input",{type:"date",value:U,onChange:a=>V(a.target.value),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-1",children:"End Date"}),(0,b.jsx)("input",{type:"date",value:W,onChange:a=>X(a.target.value),className:"w-full border rounded px-2 py-1 text-sm"}),(0,b.jsx)("p",{className:"mt-1 text-[11px] text-gray-500",children:"Leave blank if working indefinitely."})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Work Days"}),(0,b.jsxs)("select",{value:Y,onChange:a=>Z(a.target.value),className:"w-full border rounded px-2 py-1 text-sm",children:[(0,b.jsx)("option",{value:"mon-fri",children:"Monday - Friday"}),(0,b.jsx)("option",{value:"sun-thu",children:"Sunday - Thursday"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2 justify-end",children:[K&&(0,b.jsx)(d.Button,{variant:"destructive",onClick:()=>{p(a=>a.filter(a=>a.id!==K)),r(a=>a.filter(a=>a.userId!==K)),J(!1)},children:"Delete"}),(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>J(!1),children:"Cancel"}),(0,b.jsx)(d.Button,{onClick:()=>{if(M.trim()){if(K)p(a=>a.map(a=>a.id===K?{...a,name:M,department:O,entity:Q||void 0,vendorAC:S||void 0,startDate:U||void 0,endDate:W||void 0,workDays:Y}:a));else{let a={id:`user-${Date.now()}`,name:M,department:O,entity:Q||void 0,vendorAC:S||void 0,startDate:U||void 0,endDate:W||void 0,workDays:Y};p(b=>[...b,a])}J(!1),L(null),N(""),P(""),R(""),T(""),V(""),X(""),Z("mon-fri")}},children:"Save"})]})]})]})}),ac&&null!==$&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg p-6 w-[500px] max-h-[80vh] overflow-y-auto",children:[(0,b.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Select Position"}),(0,b.jsx)("div",{className:"space-y-3",children:m.flatMap(a=>(a.positions||[]).filter(a=>a.monthIndex===$&&(a.percentage||0)>0).map(b=>{let c=q.filter(c=>c.projectId===a.id&&c.monthIndex===$&&c.positionName===b.name).reduce((a,b)=>a+(b.percentage||0),0),d=Math.max(0,(b.percentage||0)-c),e=aa?aF(aa,$,d):0,f=aa?aF(aa,$,c):0;return{...b,projectId:a.id,projectName:a.name,projectColor:a.color,available:d,availableDays:e,allocated:c,allocatedDays:f}}).filter(a=>a.available>0).map(a=>{let c=`${a.projectId}-${a.id}`,d=as===c,e=aq[c]||"";return(0,b.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3 hover:bg-blue-50 transition-colors",style:{borderLeft:`4px solid ${a.projectColor}`},children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.name||"Unnamed"}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:a.projectName})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:"text-sm font-medium",children:[Math.round(a.available),"% (",a.availableDays," days)"]}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:[Math.round(a.allocated),"% (",a.allocatedDays," days) allocated"]})]})]}),(0,b.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-3",children:(0,b.jsx)("div",{className:"h-2 rounded-full transition-all duration-300",style:{width:`${a.allocated/a.percentage*100}%`,backgroundColor:a.projectColor}})}),(0,b.jsx)("div",{className:"space-y-2",children:d?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"number",min:"0",max:Math.round(a.available),value:e,onChange:a=>{ar({...aq,[c]:a.target.value})},className:"flex-1 px-3 py-2 border border-gray-300 rounded text-sm",placeholder:`Enter % (max: ${Math.round(a.available)})`}),(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"%"})]}),aa&&(0,b.jsx)("div",{className:"text-xs text-gray-500",children:e?`${Math.round(Number(e)/100*aF(aa,$,100))} days`:"0 days"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:()=>{let b=Number(e);b>0&&b<=a.available&&aG(a.projectId,a.name||"",b)},disabled:!e||0>=Number(e)||Number(e)>a.available,className:"flex-1 px-3 py-2 bg-green-600 text-white rounded text-sm hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Allocate Custom"}),(0,b.jsx)("button",{onClick:()=>{at(null),ar({...aq,[c]:""})},className:"flex-1 px-3 py-2 bg-gray-400 text-white rounded text-sm hover:bg-gray-500 transition-colors",children:"Cancel"})]})]}):(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("button",{onClick:()=>{aG(a.projectId,a.name||"",a.available)},className:"flex-1 px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors",children:["Allocate Full (",Math.round(a.available),"%)"]}),(0,b.jsx)("button",{onClick:()=>{at(c),ar({...aq,[c]:Math.round(a.available).toString()})},className:"flex-1 px-3 py-2 bg-gray-600 text-white rounded text-sm hover:bg-gray-700 transition-colors",children:"Custom Amount"})]})})]},c)}))}),m.every(a=>!a.positions?.some(a=>a.monthIndex===$&&(a.percentage||0)>0))&&(0,b.jsx)("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:"No positions available for this month. Add positions in the project settings."}),(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>{ad(!1),at(null),ar({})},className:"w-full mt-4",children:"Close"})]})}),(0,b.jsx)(h,{isOpen:ae,onClose:()=>af(!1)}),ai&&ak&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg p-4 w-full max-w-7xl max-h-[95vh] overflow-y-auto mx-2",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{className:"text-base font-bold",children:["Staff Allocation Detail - ",aA[ak.month]," ",ak.year]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600",children:"View:"}),(0,b.jsxs)("div",{className:"flex border rounded overflow-hidden",children:[(0,b.jsx)("button",{onClick:()=>ah("percentage"),className:`px-2 py-1 text-xs font-medium transition-colors ${"percentage"===ag?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"% View"}),(0,b.jsx)("button",{onClick:()=>ah("days"),className:`px-2 py-1 text-xs font-medium transition-colors ${"days"===ag?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"Days View"})]}),(0,b.jsx)("button",{onClick:()=>{if(!ak)return;let a="",b=["Staff",...az.map(a=>a.name),"Total"];a+=b.join(",")+"\n",aM.forEach(b=>{a+=`${b.department},
`,b.users.forEach(b=>{let c=[b.name];az.forEach(a=>{let d=q.filter(c=>c.userId===b.id&&c.projectId===a.id&&c.monthIndex===ak.globalIndex);if(d.length>0){let a,e=d.reduce((a,b)=>a+(b.percentage||0),0);"days"===ag?(a=Math.round(aF(b.id,ak.globalIndex,e)),c.push(`${a} days`)):(a=Math.round(e),c.push(`${a}%`))}else c.push("")});let d=q.filter(a=>a.userId===b.id&&a.monthIndex===ak.globalIndex).reduce((a,b)=>a+(b.percentage||0),0);if("days"===ag){let a=Math.round(aF(b.id,ak.globalIndex,d));c.push(`${a} days`)}else c.push(`${Math.round(d)}%`);a+=c.join(",")+"\n"})});let c=new Blob([a],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),e=URL.createObjectURL(c),f=`staff-allocation-detail-${aA[ak.month]}-${ak.year}-${ag}-${new Date().toISOString().split("T")[0]}.csv`;d.setAttribute("href",e),d.setAttribute("download",f),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)},className:"px-2 py-1 text-xs bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors ml-3",children:"Export to Excel"})]})]}),(0,b.jsx)("button",{onClick:()=>{aj(!1),al(null)},className:"px-2 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors text-xs",children:"Ã— Close"})]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full border-collapse border border-gray-300 text-xs",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"border border-gray-300 p-1 bg-gray-100 w-32 text-xs",children:"Staff"}),az.map(a=>{var c;let d,e;return(0,b.jsx)("th",{className:"border border-gray-300 p-1 bg-gray-100 min-w-24 text-xs",style:{backgroundColor:a.color,color:(d=parseInt((c=a.color).slice(1,3),16),e=parseInt(c.slice(3,5),16),(299*d+587*e+114*parseInt(c.slice(5,7),16))/1e3>128?"#000":"#fff")},children:a.name},a.id)}),(0,b.jsx)("th",{className:"border border-gray-300 p-1 bg-gray-100 w-32 text-xs",children:"Total"})]})}),(0,b.jsx)("tbody",{children:aM.map(a=>(0,b.jsxs)(c.default.Fragment,{children:[(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:az.length+2,className:"border border-gray-300 p-1 font-semibold text-xs text-gray-800 bg-cyan-200",children:a.department})}),a.users.map(a=>{let c,d,e,f,g,h;return(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"border border-gray-300 p-1 text-xs",children:a.name}),az.map(c=>{let d=q.filter(b=>b.userId===a.id&&b.monthIndex===ak.globalIndex).filter(a=>a.projectId===c.id);return(0,b.jsx)("td",{className:"border border-gray-300 p-0.5 text-center",children:d.length>0?(0,b.jsx)("div",{className:"flex flex-col gap-0.5",children:d.map(d=>{let e=c.positions?.find(a=>a.id===d.positionId),f="days"===ag?aF(a.id,ak.globalIndex,d.percentage):Math.round(d.percentage||0),g="days"===ag?`${Math.round(f)} days`:`${f}%`;return(0,b.jsx)("div",{className:"text-[10px] px-1 py-0.5 rounded text-white leading-tight",style:{backgroundColor:c.color},title:`${e?.name||"Position"} - ${Math.round(d.percentage||0)}%`,children:g},d.id)})}):(0,b.jsx)("div",{className:"text-[10px] text-gray-400",children:"-"})},c.id)}),(0,b.jsx)("td",{className:"border border-gray-300 p-0.5 text-center text-xs font-medium",children:(c=q.filter(b=>b.userId===a.id&&b.monthIndex===ak.globalIndex).reduce((a,b)=>a+(b.percentage||0),0),d=aF(a.id,ak.globalIndex,c),e=Math.round(c),f=Math.round(d),g="#F59E0B",h="transparent",e>=100?e>100?(g="#10B981",h="#EF4444"):(g="#10B981",h="transparent"):(g="#F59E0B",h="transparent"),(0,b.jsx)("div",{className:"w-full",children:(0,b.jsxs)("div",{className:"w-full h-3 rounded relative overflow-hidden",style:{backgroundColor:"#E5E7EB",border:"transparent"!==h?`2px solid ${h}`:"none"},children:[(0,b.jsx)("div",{className:"h-full rounded transition-all duration-300",style:{width:`${Math.min(c,100)}%`,backgroundColor:g}}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-[9px] font-medium",children:"days"===ag?`${f} days`:`${e}%`})]})}))})]},a.id)})]},a.department))})]})})]})}),am&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-6xl max-h-[90vh] overflow-y-auto mx-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,b.jsx)("h2",{className:"text-xl font-bold",children:"Project Gantt Chart"}),(0,b.jsx)("button",{onClick:()=>an(!1),className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"Ã—"})]}),(0,b.jsx)("div",{className:"space-y-4",children:0===m.length?(0,b.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No projects to display in Gantt chart"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"bg-gray-50 p-3 rounded-lg",children:(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Project Timeline (Monthly View)"}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:["Based on today's date: ",new Date().toLocaleDateString()]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("label",{className:"text-xs font-medium text-gray-600",children:"Start Year:"}),(0,b.jsx)("select",{value:ao,onChange:a=>ap(Number(a.target.value)),className:"border border-gray-300 rounded px-2 py-1 text-xs bg-white",children:(()=>{let a=m.flatMap(a=>[a.startYear||2024,a.endYear||2024]),c=Math.min(...a,new Date().getFullYear()-2),d=Math.max(...a,new Date().getFullYear()+2),e=[];for(let a=c;a<=d;a++)e.push(a);return e.map(a=>(0,b.jsx)("option",{value:a,children:a},a))})()})]})]})}),(()=>{let a,c,d,e=[],f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];for(let a=ao;a<ao+2;a++)for(let b=0;b<12;b++)e.push({year:a,month:b,label:`${f[b]} ${a}`});let g=new Date,h=g.getFullYear(),i=g.getMonth(),j=e.findIndex(a=>a.year===h&&a.month===i);return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"border rounded-lg overflow-hidden relative",children:[j>=0&&(0,b.jsx)("div",{className:"absolute top-0 bottom-0 w-0.5 bg-red-500 z-10 pointer-events-none",style:{left:`calc((3 / (months.length + 3)) * 100% + ${(j+.5)*(97/(e.length+3))}%)`},children:(0,b.jsx)("div",{className:"absolute -top-2 -left-3 w-6 h-4 bg-red-500 text-white text-xs rounded flex items-center justify-center font-bold",children:"Today"})}),(0,b.jsxs)("div",{className:"grid bg-gray-100",style:{gridTemplateColumns:"3fr repeat(24, 1fr)"},children:[(0,b.jsx)("div",{className:"p-0.5 text-xs font-medium text-gray-700 border-r",children:"Project"}),e.map((a,c)=>(0,b.jsxs)("div",{className:"p-0 text-xs font-medium text-center text-gray-700 border-r last:border-r-0",children:[(0,b.jsx)("div",{className:"text-xs",children:a.label.split(" ")[0]}),(0,b.jsx)("div",{className:"text-xs font-bold",children:a.label.split(" ")[1]})]},`${a.year}-${a.month}`))]}),(a=m.filter(a=>{let b=new Date(a.startYear||2024,a.startMonth||0,1),c=new Date(a.endYear||2024,a.endMonth||11,1);return g>=b&&g<=c})).length>0?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"p-0.5 bg-blue-50 text-xs font-medium text-blue-700 border-b",style:{gridColumn:"1 / -1"},children:["ðŸ”µ Ongoing (",a.length,")"]}),a.map(a=>{let c=new Date(a.startYear||2024,a.startMonth||0,1),d=new Date(a.endYear||2024,a.endMonth||11,1);return(d.getTime()-c.getTime())/864e5,(g.getTime()-c.getTime())/864e5,(0,b.jsxs)("div",{className:"grid border-b hover:bg-gray-50 relative",style:{gridTemplateColumns:"3fr repeat(24, 1fr)"},children:[(0,b.jsx)("div",{className:"p-0.5 border-r",children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("div",{className:"w-2 h-2 rounded flex-shrink-0",style:{backgroundColor:a.color}}),(0,b.jsx)("span",{className:"text-xs font-medium truncate",children:a.name})]})}),e.map((e,f)=>{let j=new Date(e.year,e.month,1),k=new Date(e.year,e.month+1,0),l=c<j?j:c,m=d>k?k:d,n=l<=m,o=Math.ceil((k.getTime()-j.getTime())/864e5),p=n?Math.ceil((m.getTime()-l.getTime())/864e5):0,q=e.year===h&&e.month===i&&g>=c&&g<=d;return(0,b.jsx)("div",{className:"border-r last:border-r-0 p-0",children:n?(0,b.jsxs)("div",{className:"relative h-3 bg-gray-200 rounded overflow-hidden",children:[(0,b.jsx)("div",{className:"h-full rounded transition-all duration-300",style:{width:`${n?p/o*100:0}%`,backgroundColor:a.color,opacity:q?1:.8}}),q&&(0,b.jsx)("div",{className:"absolute inset-0 border-2 border-blue-400 rounded pointer-events-none"})]}):(0,b.jsx)("div",{className:"h-3"})},`${e.year}-${e.month}`)})]},a.id)})]}):null,(c=m.filter(a=>g>new Date(a.endYear||2024,a.endMonth||11,1))).length>0?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"p-0.5 bg-green-50 text-xs font-medium text-green-700 border-b",style:{gridColumn:"1 / -1"},children:["ðŸŸ¢ Completed (",c.length,")"]}),c.map(a=>{let c=new Date(a.startYear||2024,a.startMonth||0,1),d=new Date(a.endYear||2024,a.endMonth||11,1);return(0,b.jsxs)("div",{className:"grid border-b hover:bg-gray-50",style:{gridTemplateColumns:"3fr repeat(24, 1fr)"},children:[(0,b.jsx)("div",{className:"p-0.5 border-r",children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("div",{className:"w-2 h-2 rounded flex-shrink-0",style:{backgroundColor:a.color}}),(0,b.jsx)("span",{className:"text-xs font-medium truncate",children:a.name})]})}),e.map(e=>{let f=new Date(e.year,e.month,1),g=new Date(e.year,e.month+1,0),h=c<f?f:c,i=d>g?g:d,j=h<=i,k=Math.ceil((g.getTime()-f.getTime())/864e5),l=j?Math.ceil((i.getTime()-h.getTime())/864e5):0;return(0,b.jsx)("div",{className:"border-r last:border-r-0 p-0",children:j?(0,b.jsx)("div",{className:"relative h-3 bg-gray-200 rounded overflow-hidden",children:(0,b.jsx)("div",{className:"h-full rounded transition-all duration-300",style:{width:`${j?l/k*100:0}%`,backgroundColor:a.color,opacity:.7}})}):(0,b.jsx)("div",{className:"h-3"})},`${e.year}-${e.month}`)})]},a.id)})]}):null,(d=m.filter(a=>g<new Date(a.startYear||2024,a.startMonth||0,1))).length>0?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"p-0.5 bg-yellow-50 text-xs font-medium text-yellow-700 border-b",style:{gridColumn:"1 / -1"},children:["ðŸŸ¡ Planned (",d.length,")"]}),d.map(a=>{let c=new Date(a.startYear||2024,a.startMonth||0,1),d=new Date(a.endYear||2024,a.endMonth||11,1);return c.getTime(),g.getTime(),(0,b.jsxs)("div",{className:"grid border-b hover:bg-gray-50",style:{gridTemplateColumns:"3fr repeat(24, 1fr)"},children:[(0,b.jsx)("div",{className:"p-0.5 border-r",children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("div",{className:"w-2 h-2 rounded flex-shrink-0",style:{backgroundColor:a.color}}),(0,b.jsx)("span",{className:"text-xs font-medium truncate",children:a.name})]})}),e.map(e=>{let f=new Date(e.year,e.month,1),g=new Date(e.year,e.month+1,0),h=c<f?f:c,i=d>g?g:d,j=h<=i,k=Math.ceil((g.getTime()-f.getTime())/864e5),l=j?Math.ceil((i.getTime()-h.getTime())/864e5):0;return(0,b.jsx)("div",{className:"border-r last:border-r-0 p-0",children:j?(0,b.jsx)("div",{className:"relative h-3 bg-gray-200 rounded overflow-hidden",children:(0,b.jsx)("div",{className:"h-full rounded transition-all duration-300",style:{width:`${j?l/k*100:0}%`,backgroundColor:a.color,opacity:.6,borderStyle:"dashed"}})}):(0,b.jsx)("div",{className:"h-3"})},`${e.year}-${e.month}`)})]},a.id)})]}):null]}),(0,b.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Timeline Range"}),(0,b.jsxs)("div",{className:"text-xs text-gray-600",children:["Showing: ",ao," - ",ao+1," (24 months)"]})]}),(0,b.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Summary"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-3 text-xs",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"font-medium text-green-600",children:m.filter(a=>new Date>new Date(a.endYear||2024,a.endMonth||11,1)).length}),(0,b.jsx)("div",{className:"text-gray-500",children:"Completed"})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"font-medium text-blue-600",children:m.filter(a=>{let b=new Date(a.startYear||2024,a.startMonth||0,1),c=new Date(a.endYear||2024,a.endMonth||11,1);return g>=b&&g<=c}).length}),(0,b.jsx)("div",{className:"text-gray-500",children:"Ongoing"})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"font-medium text-yellow-600",children:m.filter(a=>new Date<new Date(a.startYear||2024,a.startMonth||0,1)).length}),(0,b.jsx)("div",{className:"text-gray-500",children:"Planned"})]})]})]})]})})()]})})]})})]})}a.s(["AllocationGrid",()=>j],74015)}];

//# sourceMappingURL=components_allocation-grid_tsx_39a07c58._.js.map