(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,38367,e=>{"use strict";var t=e.i(1972),r=e.i(75305),a=e.i(67881);function s({userId:e,monthIndex:a,allocations:s=[],onEdit:l,onSaveEdit:n,onRemove:i,onEmptyCellClick:o,projects:d=[],users:c=[],userEnded:m=!1,userNotStarted:x=!1,viewMode:u="percentage",getDaysFromPercentage:h,readOnly:p=!1}){let[g,b]=(0,r.useState)(!1),[f,j]=(0,r.useState)(null),[y,v]=(0,r.useState)(0),N=(e,t,r)=>{if(h)return h(e,t,r);let a=Math.floor(t/12)+2024,s=t%12,l=new Date(a,s,1),n=new Date(a,s+1,0).getDate(),i=0;for(let e=1;e<=n;e++){l.setDate(e);let t=l.getDay();t>=1&&t<=5&&i++}return Math.round(r/100*i)},w=s.reduce((e,t)=>e+(t.percentage||0),0),C=Math.max(0,100-w);return(0,t.jsx)("td",{"data-user-id":e,"data-month":a,className:`w-32 border-r border-b border-border bg-background px-1 py-0.5 min-h-8 transition-colors relative ${m||x||p?"cursor-not-allowed bg-gray-50":C>0&&o?"cursor-pointer hover:bg-muted/50":"hover:bg-muted/30"}`,onMouseEnter:()=>!m&&!x&&!p&&C>0&&b(!0),onMouseLeave:()=>b(!1),onClick:m||x||p?void 0:()=>{C>0&&o&&!x&&o()},children:(0,t.jsxs)("div",{className:"flex flex-col h-full gap-0.5",children:[(0,t.jsxs)("div",{className:"flex items-center flex-1",children:[(0,t.jsx)("div",{className:`flex w-full h-4 rounded overflow-hidden bg-gray-100 ${100===w?"border-2 border-green-500":w>100?"border-2 border-red-500":""}`,children:m?(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-[8px] font-semibold text-gray-500 bg-gray-200",children:"ended"}):x?(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-[8px] font-semibold text-gray-500 bg-gray-200",children:"not started"}):s.map(r=>{let s=d.find(e=>e.id===r.projectId);console.log("[v0] AllocationCell rendering bar:",{allocationId:r.id,projectId:r.projectId,projectColor:s?.color});let n=Math.max(0,Math.min(100,(r.percentage||0)/(w>100?w:100)*100)),o="days"===u?Math.round(N(e,a,r.percentage||0)):Math.round(r.percentage||0),c="days"===u?`${o} days`:`${o}%`;return N(e,a,r.percentage||0),(0,t.jsxs)("div",{className:`h-full text-[8px] flex items-center justify-center font-semibold relative ${p?"":"group cursor-pointer"} text-white`,style:{backgroundColor:s?.color||"#999",width:`${n}%`,minWidth:n>0?"8%":void 0},onClick:e=>{p||(e.stopPropagation(),l?.(r.id))},title:`${s?.name??"Project"} - ${r.positionName||r.name||"Position"} (${c})`,children:[c,!p&&(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),i?.(r.id)},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity",children:"Ã—"})]},r.id)})}),!m&&!x&&w>=90&&w<=100&&s.length>0&&(0,t.jsx)("div",{className:"ml-1 flex-shrink-0",children:(0,t.jsx)("svg",{className:"w-4 h-4 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),!m&&!x&&!p&&g&&C>0&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-primary/10 rounded text-[9px] text-primary font-medium pointer-events-none",children:"Click to select position"})]})})}function l({projects:e,positions:a=[],months:s,startMonth:l=0,startYear:n=2024,onAddProject:i,onUpdateProject:o,onDeleteProject:d,onUpdatePositions:c,onProjectSelect:m,selectedProjectId:x,onCleanupAllocations:u,currentUserRole:h}){let p,[g,b]=(0,r.useState)(!1),[f,j]=(0,r.useState)(null),[y,v]=(0,r.useState)(""),[N,w]=(0,r.useState)("#3B82F6"),[C,k]=(0,r.useState)([]),[S,D]=(0,r.useState)(0),[I,M]=(0,r.useState)(2024),[$,E]=(0,r.useState)(0),[U,A]=(0,r.useState)(2024),[B,T]=(0,r.useState)(0),[Y,P]=(0,r.useState)("percentage"),F="admin"===h||"editor"===h,z=["January","February","March","April","May","June","July","August","September","October","November","December"],O=Array.from({length:10},(e,t)=>2024+t),J=(e,t,r=1)=>{let a=new Date(e,t,1),s=new Date(e,t+1,0).getDate(),l=0;for(let e=1;e<=s;e++){a.setDate(e);let t=a.getDay();1===r?t>=1&&t<=5&&l++:t>=0&&t<=4&&l++}return l},R=(e,t)=>(t-2024)*12+e,L=e=>({month:e%12,year:2024+Math.floor(e/12)}),G=(p=R(S,I),Math.max(1,R($,U)-p+1)),V=(()=>{let e=R(S,I),t=R($,U),r=e+12*B,a=Math.min(r+12,t+1),s=[];for(let e=r;e<a;e++){let{month:t,year:r}=L(e);s.push({month:t,year:r,displayName:`${z[t].slice(0,3)} ${r.toString().slice(-2)}`,globalIndex:e})}return s})(),W=Math.ceil(G/12);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-wrap gap-4 items-center",children:[e.map(r=>{var s;let l,n,i=(l=parseInt((s=r.color).slice(1,3),16),n=parseInt(s.slice(3,5),16),(299*l+587*n+114*parseInt(s.slice(5,7),16))/1e3>128?"#000":"#fff");return(0,t.jsxs)("div",{className:`flex items-center justify-between px-3 py-1.5 rounded border border-border cursor-pointer hover:opacity-80 transition-opacity w-32 h-8 ${x===r.id?"ring-2 ring-offset-2 ring-blue-500":""}`,style:{backgroundColor:r.color,color:i},onClick:()=>{m&&m(x===r.id?null:r.id)},children:[(0,t.jsx)("span",{className:"text-xs font-medium truncate flex-1",children:r.name}),F&&(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),(t=>{j(t);let r=e.find(e=>e.id===t);if(r){v(r.name),w(r.color),D(r.startMonth??0),M(r.startYear??2024),E(r.endMonth??0),A(r.endYear??2024),P(r.allocationMode??"percentage"),T(0);let e=a.filter(e=>e.projectId===t),s=new Map;e.forEach(e=>{let t=e.name||"Unnamed Position";s.has(t)||s.set(t,{id:`${t}-${Date.now()}`,name:t,projectTask:e.projectTask,budgets:{}});let a=s.get(t),l="days"===r.allocationMode&&e.days?e.days:e.percentage;a.budgets[e.monthIndex]=l}),k(Array.from(s.values()))}})(r.id)},className:"px-1.5 py-0.5 text-[10px] bg-white/20 rounded hover:bg-white/30 transition-colors flex-shrink-0",style:{color:i},children:"Edit"})]},r.id)}),F&&(0,t.jsx)("button",{onClick:()=>b(!0),className:"px-4 py-2 bg-primary text-primary-foreground rounded font-medium hover:bg-primary/90 transition-colors text-sm",children:"+ New Project"})]}),(g||f)&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-card p-6 rounded-lg border border-border shadow-lg w-full h-full mx-4 overflow-y-auto",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-foreground mb-4",children:f?"Edit Project":"Create New Project"}),(0,t.jsxs)("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"Project Name"}),(0,t.jsx)("input",{type:"text",value:y,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-border rounded text-foreground bg-card",placeholder:"Enter project name",disabled:!F,autoFocus:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"Project Color"}),(0,t.jsx)("div",{className:"flex gap-2 flex-wrap",children:["#3B82F6","#10B981","#F59E0B","#8B5CF6","#EC4899","#06B6D4","#EF4444","#14B8A6"].map(e=>(0,t.jsx)("button",{onClick:()=>{console.log("[v0] Color picker clicked, setting color to:",e),w(e)},className:`w-8 h-8 rounded transition-all ${N===e?"ring-2 ring-offset-2 ring-primary":"hover:opacity-80"}`,style:{backgroundColor:e},title:e},e))})]})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"Allocation Mode"}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",name:"allocationMode",value:"percentage",checked:"percentage"===Y,onChange:e=>P("percentage"),className:"text-primary",disabled:!F}),(0,t.jsx)("span",{className:"text-sm",children:"% Allocation"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",name:"allocationMode",value:"days",checked:"days"===Y,onChange:e=>P("days"),className:"text-primary",disabled:!F}),(0,t.jsx)("span",{className:"text-sm",children:"Day Allocation"})]})]})]}),(0,t.jsxs)("div",{className:"mb-6 grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"Start Month"}),(0,t.jsx)("select",{value:S,onChange:e=>D(Number(e.target.value)),className:"border border-border rounded px-3 py-2 w-full text-sm bg-background text-foreground",disabled:!F,children:z.map((e,r)=>(0,t.jsx)("option",{value:r,children:e},r))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"Start Year"}),(0,t.jsx)("select",{value:I,onChange:e=>M(Number(e.target.value)),className:"border border-border rounded px-3 py-2 w-full text-sm bg-background text-foreground",disabled:!F,children:O.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"End Month"}),(0,t.jsx)("select",{value:$,onChange:e=>E(Number(e.target.value)),className:"border border-border rounded px-3 py-2 w-full text-sm bg-background text-foreground",disabled:!F,children:z.map((e,r)=>(0,t.jsx)("option",{value:r,children:e},r))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-muted-foreground mb-2 block",children:"End Year"}),(0,t.jsx)("select",{value:U,onChange:e=>A(Number(e.target.value)),className:"border border-border rounded px-3 py-2 w-full text-sm bg-background text-foreground",disabled:!F,children:O.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsxs)("label",{className:"text-xs font-medium text-muted-foreground",children:["Positions by Month (","days"===Y?"Days":"%",") - Page ",B+1," of ",W]}),(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)("button",{onClick:()=>T(Math.max(0,B-1)),disabled:0===B,className:"px-3 py-1 text-xs bg-primary text-primary-foreground rounded hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"â† Prev 12"}),(0,t.jsx)("button",{onClick:()=>T(Math.min(W-1,B+1)),disabled:B>=W-1,className:"px-3 py-1 text-xs bg-primary text-primary-foreground rounded hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Next 12 â†’"}),(0,t.jsx)("button",{onClick:()=>{k([...C,{id:`pos-${Date.now()}`,name:"New Position",budgets:{}}])},className:"px-3 py-1 text-xs bg-primary text-primary-foreground rounded hover:bg-primary/90 transition-colors",disabled:!F,children:"+ Add Position"}),(0,t.jsx)("button",{onClick:()=>{if(0===C.length)return void alert("No positions to export");let e="",t=["Project Task","Position Name",...V.map(e=>e.displayName)];e+=t.join(",")+"\n",C.filter(e=>""!==e.name.trim()).forEach(t=>{let r=[t.projectTask||"",t.name];V.forEach(e=>{let a=t.budgets[e.globalIndex]||0;r.push(a.toString())}),e+=r.join(",")+"\n"});let r=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),s=URL.createObjectURL(r),l=y||"Project",n=`${l}-positions-${Y}-${new Date().toISOString().split("T")[0]}.csv`;a.setAttribute("href",s),a.setAttribute("download",n),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)},className:"px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition-colors",title:"Export positions to Excel",children:"ðŸ“¥ Export"}),(0,t.jsx)("button",{onClick:()=>document.getElementById("excel-import-input")?.click(),className:"px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",title:"Import positions from Excel",disabled:!F,children:"ðŸ“¤ Import"}),(0,t.jsx)("input",{id:"excel-import-input",type:"file",accept:".xlsx,.xls,.csv",onChange:e=>{let t=e.target.files?.[0];if(!t)return;let r=new FileReader;r.onload=e=>{try{let t=(e.target?.result).split("\n").filter(e=>e.trim());if(t.length<2)return void alert("File must contain at least a header row and one data row");t[0].split(",").map(e=>e.trim()).slice(2);let r=[];for(let e=1;e<t.length;e++){let a=t[e].split(",").map(e=>e.trim());if(a.length<3||!a[1])continue;let s=a[0],l=a[1],n={};a.slice(2).forEach((e,t)=>{if(t<V.length){let r=parseFloat(e)||0;n[V[t].globalIndex]=r}}),r.push({id:`imported-${l}-${Date.now()}-${e}`,name:l,projectTask:s,budgets:n})}if(r.length>0){if(C.some(e=>""!==e.name.trim())&&!confirm(`Import will replace existing positions with ${r.length} imported positions. Continue?`))return;k(r),alert(`Successfully imported ${r.length} positions`)}else alert("No valid position data found in file")}catch(e){console.error("Import error:",e),alert("Error importing file. Please check the file format and try again.")}},r.onerror=()=>{alert("Error reading file")},r.readAsText(t),e.target&&(e.target.value="")},style:{display:"none"},disabled:!F})]})]}),(0,t.jsx)("div",{className:"border border-border rounded overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-[10px]",children:[(0,t.jsx)("thead",{className:"bg-muted border-b border-border",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-muted-foreground min-w-20",children:"Project Task"}),(0,t.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-muted-foreground min-w-40",children:"Position Name"}),V.map(e=>(0,t.jsx)("th",{className:"px-4 py-2 text-center font-semibold text-muted-foreground min-w-20",children:e.displayName},e.globalIndex)),(0,t.jsx)("th",{className:"px-4 py-2 text-center font-semibold text-muted-foreground w-10",children:"Action"})]})}),(0,t.jsx)("tbody",{children:0===C.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:V.length+3,className:"px-4 py-8 text-center text-muted-foreground",children:'No positions yet. Click "Add Position" to create one.'})}):C.map(e=>(0,t.jsxs)("tr",{className:"border-t border-border hover:bg-muted/50",children:[(0,t.jsx)("td",{className:"px-4 py-2 border-r border-border",children:(0,t.jsx)("input",{type:"text",value:e.projectTask||"",onChange:t=>{var r,a;return r=e.id,a=t.target.value,void k(C.map(e=>e.id===r?{...e,projectTask:a}:e))},className:"w-full px-2 py-1 border border-border rounded text-foreground bg-card",placeholder:"e.g., 01.03.01",disabled:!F})}),(0,t.jsx)("td",{className:"px-4 py-2 border-r border-border",children:(0,t.jsx)("input",{type:"text",value:e.name,onChange:t=>{var r,a;return r=e.id,a=t.target.value,void k(C.map(e=>e.id===r?{...e,name:a}:e))},className:"w-full px-2 py-1 border border-border rounded text-foreground bg-card",placeholder:"e.g., Senior Developer",disabled:!F})}),V.map(r=>(0,t.jsx)("td",{className:"px-4 py-2 border-r border-border last:border-r-0 bg-background",children:(0,t.jsx)("input",{type:"number",min:"0",max:"days"===Y?J(r.year,r.month,1):999,value:e.budgets[r.globalIndex]||"",onChange:t=>{var a,s,l;return a=e.id,s=r.globalIndex,l=t.target.value?Number(t.target.value):0,void k(C.map(e=>e.id===a?{...e,budgets:{...e.budgets,[s]:l}}:e))},className:"w-full px-2 py-1 text-center border border-border rounded text-foreground bg-card",placeholder:"days"===Y?`0-${J(r.year,r.month,1)} days`:"0%",disabled:!F})},r.globalIndex)),(0,t.jsx)("td",{className:"px-4 py-2 text-center",children:(0,t.jsx)("button",{onClick:()=>{var t;return t=e.id,void k(C.filter(e=>e.id!==t))},className:"px-2 py-1 text-xs bg-destructive text-destructive-foreground rounded hover:bg-destructive/90 transition-colors",disabled:!F,children:"âœ•"})})]},e.id))})]})})]}),(0,t.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,t.jsx)("button",{onClick:()=>{b(!1),j(null),v(""),w("#3B82F6"),k([]),D(0),M(2024),E(0),A(2024),T(0),P("percentage")},className:"px-4 py-2 bg-muted text-muted-foreground rounded font-medium hover:bg-muted/80 transition-colors text-sm",children:"Cancel"}),f&&(0,t.jsx)("button",{onClick:()=>{window.confirm("Are you sure you want to delete this project? All positions will be removed.")&&(d(f),j(null),v(""),w("#3B82F6"),k([]),D(0),M(2024),E(0),A(2024),T(0),P("percentage"))},className:"px-4 py-2 bg-destructive text-black rounded font-medium hover:bg-destructive/90 transition-colors text-sm",children:"Delete Project"}),(0,t.jsx)("button",{onClick:f?()=>{if(!f||!y.trim())return;console.log("[v0] Saving project with dates:",{projectId:f,startMonth:S,startYear:I,endMonth:$,endYear:U}),console.log("[v0] Saving project with color:",{projectId:f,selectedColor:N}),console.log("[v0] About to call onUpdateProject with:",{projectId:f,name:y,color:N,startMonth:S,startYear:I,endMonth:$,endYear:U});let t=a.filter(e=>e.projectId===f),r=[];C.forEach(a=>{V.forEach(s=>{let l=a.budgets[s.globalIndex]||0;if(l>0){let n=t.find(e=>e.monthIndex===s.globalIndex&&e.name===a.name),i=e.find(e=>e.id===f),o=i?.allocationMode||"percentage",d={id:n?.id||`pos-${f}-${a.id}-${s.globalIndex}`,projectId:f,monthIndex:s.globalIndex,percentage:"days"===o?l/J(s.year,s.month,1)*100:l,allocated:n?.allocated||0,name:a.name,projectTask:a.projectTask,days:"days"===o?l:void 0};r.push(d)}})}),c([...a.filter(e=>e.projectId!==f),...r]),u&&u(f,r.map(e=>e.id)),o(f,{name:y,color:N,startMonth:S,startYear:I,endMonth:$,endYear:U,allocationMode:Y}),j(null),v(""),w("#3B82F6"),k([]),D(0),M(2024),E(0),A(2024),T(0),P("percentage")}:()=>{if(!y.trim())return;console.log("[DEBUG] Creating project with dates:",{projectStartMonth:S,projectStartYear:I,projectEndMonth:$,projectEndYear:U});let e={id:`proj-${Date.now()}`,name:y,color:N,startMonth:S,startYear:I,endMonth:$,endYear:U,allocationMode:Y};console.log("[DEBUG] Project object being created:",e),i(e);let t=[];R(S,I),R($,U),C.forEach(r=>{V.forEach((a,s)=>{let l=r.budgets[a.globalIndex]||0;if(l>0){let s={id:`pos-${e.id}-${r.id}-${a.globalIndex}`,projectId:e.id,monthIndex:a.globalIndex,percentage:"days"===Y?l/J(a.year,a.month,1)*100:l,allocated:0,name:r.name,projectTask:r.projectTask,days:"days"===Y?l:void 0};t.push(s)}})}),t.length>0&&c([...a,...t]),v(""),w("#3B82F6"),k([]),D(0),M(2024),E(0),A(2024),T(0),P("percentage"),b(!1)},className:"px-4 py-2 bg-primary text-primary-foreground rounded font-medium hover:bg-primary/90 transition-colors text-sm",disabled:!F,children:f?"Save Changes":"Create Project"})]})]})})]})}var n=e.i(56563);function i({isOpen:e,onClose:s}){let[l,i]=(0,r.useState)((0,n.getSystemUsers)()),[o,d]=(0,r.useState)({email:"",name:"",password:"",role:"editor"}),[c,m]=(0,r.useState)(!1),[x,u]=(0,r.useState)(null),[h,p]=(0,r.useState)({email:"",name:"",password:"",role:"editor"}),[g,b]=(0,r.useState)(()=>(0,n.getCurrentUserData)().entities||[]),[f,j]=(0,r.useState)(""),[y,v]=(0,r.useState)(""),[N,w]=(0,r.useState)(""),[C,k]=(0,r.useState)(""),[S,D]=(0,r.useState)(!1),[I,M]=(0,r.useState)(!1);r.default.useEffect(()=>{(0,n.setCurrentUserData)({entities:g})},[g]);let $=()=>{let e=(0,n.getSystemUsers)();console.log("All users in system:",e),i(e)};return e?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Settings"}),(0,t.jsx)(a.Button,{onClick:s,variant:"outline",size:"sm",children:"Ã—"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[x&&(0,t.jsxs)("div",{className:"p-4 border rounded-lg bg-blue-50 space-y-3",children:[(0,t.jsxs)("h4",{className:"font-medium text-sm",children:["Edit User: ",x.name]}),(0,t.jsx)("input",{type:"email",placeholder:"Email",value:h.email,onChange:e=>p({...h,email:e.target.value}),className:"w-full px-3 py-2 border rounded text-sm"}),(0,t.jsx)("input",{type:"text",placeholder:"Name",value:h.name,onChange:e=>p({...h,name:e.target.value}),className:"w-full px-3 py-2 border rounded text-sm"}),(0,t.jsx)("input",{type:"password",placeholder:"Password (leave empty to keep current)",value:h.password,onChange:e=>p({...h,password:e.target.value}),className:"w-full px-3 py-2 border rounded text-sm"}),(0,t.jsxs)("select",{value:h.role,onChange:e=>p({...h,role:e.target.value}),className:"w-full px-3 py-2 border rounded text-sm",children:[(0,t.jsx)("option",{value:"admin",children:"Admin"}),(0,t.jsx)("option",{value:"editor",children:"Editor"}),(0,t.jsx)("option",{value:"viewer",children:"Viewer"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(a.Button,{onClick:()=>{x&&h.email&&h.name&&((0,n.updateSystemUser)(x.id,{email:h.email,name:h.name,password:h.password||x.password,role:h.role}),u(null),p({email:"",name:"",password:"",role:"editor"}),$())},size:"sm",children:"Save Changes"}),(0,t.jsx)(a.Button,{onClick:()=>{u(null),p({email:"",name:"",password:"",role:"editor"})},variant:"outline",size:"sm",children:"Cancel"})]})]}),c&&(0,t.jsxs)("div",{className:"p-4 border rounded-lg bg-gray-50 space-y-3",children:[(0,t.jsx)("input",{type:"email",placeholder:"Email",value:o.email,onChange:e=>d({...o,email:e.target.value}),className:"w-full px-3 py-2 border rounded text-sm"}),(0,t.jsx)("input",{type:"text",placeholder:"Name",value:o.name,onChange:e=>d({...o,name:e.target.value}),className:"w-full px-3 py-2 border rounded text-sm"}),(0,t.jsx)("input",{type:"password",placeholder:"Password",value:o.password,onChange:e=>d({...o,password:e.target.value}),className:"w-full px-3 py-2 border rounded text-sm"}),(0,t.jsxs)("select",{value:o.role,onChange:e=>d({...o,role:e.target.value}),className:"w-full px-3 py-2 border rounded text-sm",children:[(0,t.jsx)("option",{value:"admin",children:"Admin"}),(0,t.jsx)("option",{value:"editor",children:"Editor"}),(0,t.jsx)("option",{value:"viewer",children:"Viewer"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(a.Button,{onClick:()=>{o.email&&o.name&&o.password&&(console.log("Adding user:",o),console.log("User added successfully:",(0,n.addSystemUser)({email:o.email,name:o.name,password:o.password,role:o.role,isActive:!0})),d({email:"",name:"",password:"",role:"editor"}),m(!1),$())},size:"sm",children:"Add User"}),(0,t.jsx)(a.Button,{onClick:()=>m(!1),variant:"outline",size:"sm",children:"Cancel"})]})]}),!c&&(0,t.jsx)(a.Button,{onClick:()=>m(!0),variant:"outline",size:"sm",children:"+ Add New User"}),(0,t.jsx)("div",{className:"space-y-2",children:l.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:e.email}),(0,t.jsxs)("div",{className:"text-xs",children:[(0,t.jsx)("span",{className:`px-2 py-1 rounded text-xs ${"admin"===e.role?"bg-red-100 text-red-700":"editor"===e.role?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:e.role}),(0,t.jsx)("span",{className:`ml-2 px-2 py-1 rounded text-xs ${e.isActive?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:e.isActive?"Active":"Inactive"})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(a.Button,{onClick:()=>{u(e),p({email:e.email,name:e.name,password:e.password,role:e.role})},variant:"outline",size:"sm",children:"Edit"}),(0,t.jsx)(a.Button,{onClick:()=>{var t,r;return t=e.id,r=!e.isActive,void((0,n.updateSystemUser)(t,{isActive:r}),$())},variant:"outline",size:"sm",children:e.isActive?"Deactivate":"Activate"}),"admin@sola.com"!==e.email&&(0,t.jsx)(a.Button,{onClick:()=>{var t;return t=e.id,void(confirm("Are you sure you want to delete this user?")&&((0,n.deleteSystemUser)(t),$()))},variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",children:"Delete"})]})]},e.id))})]}),(0,t.jsxs)("div",{className:"border-t pt-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-gray-700",children:"Entity Management"}),(0,t.jsx)(a.Button,{onClick:()=>D(!S),variant:"outline",size:"sm",children:S?"Hide":"Show"})]}),S&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"border rounded-lg p-3 bg-gray-50",children:[(0,t.jsx)("h5",{className:"text-sm font-medium mb-2",children:"Add New Entity"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsx)("input",{type:"text",placeholder:"Entity Name",value:f,onChange:e=>j(e.target.value),className:"px-2 py-1 border rounded text-sm"}),(0,t.jsx)("input",{type:"text",placeholder:"Currency Code",value:y,onChange:e=>v(e.target.value),className:"px-2 py-1 border rounded text-sm"}),(0,t.jsx)("input",{type:"text",placeholder:"Tax Account",value:N,onChange:e=>w(e.target.value),className:"px-2 py-1 border rounded text-sm"}),(0,t.jsx)("input",{type:"text",placeholder:"SS Account",value:C,onChange:e=>k(e.target.value),className:"px-2 py-1 border rounded text-sm"})]}),(0,t.jsx)(a.Button,{onClick:()=>{if(!f.trim()||!y.trim())return;let e={id:`entity-${Date.now()}`,name:f.trim(),currencyCode:y.trim(),taxAccount:N.trim(),ssAccount:C.trim()};b(t=>[...t,e]),j(""),v(""),w(""),k("")},size:"sm",className:"mt-2",children:"Add Entity"})]}),g.length>0&&(0,t.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,t.jsx)("h5",{className:"text-sm font-medium mb-2",children:"Existing Entities"}),(0,t.jsx)("div",{className:"space-y-2",children:g.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded text-xs bg-gray-50",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),(0,t.jsxs)("div",{className:"text-gray-600",children:["Currency: ",e.currencyCode," | Tax: ",e.taxAccount," | SS: ",e.ssAccount]})]}),(0,t.jsx)(a.Button,{onClick:()=>{var t;return t=e.id,void(confirm("Are you sure you want to delete this entity?")&&b(e=>e.filter(e=>e.id!==t)))},variant:"destructive",size:"sm",children:"Delete"})]},e.id))})]})]})]}),(0,t.jsxs)("div",{className:"border-t pt-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-gray-700",children:"Backup Management"}),(0,t.jsx)(a.Button,{onClick:()=>M(!I),variant:"outline",size:"sm",children:I?"Hide":"Show"})]}),I&&(0,t.jsx)("div",{className:"space-y-3",children:(0,t.jsxs)("div",{className:"border rounded-lg p-3 bg-gray-50",children:[(0,t.jsx)("h5",{className:"text-sm font-medium mb-2",children:"Data Backup & Restore"}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mb-3",children:"Create backups of all your data (projects, users, entities, allocations) and restore them when needed."}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded bg-white",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium",children:"Create Backup"}),(0,t.jsx)("div",{className:"text-xs text-gray-600",children:"Download all data as JSON file"})]}),(0,t.jsx)(a.Button,{onClick:()=>{if(!(0,n.getCurrentUser)())return;let e=(0,n.getCurrentUserData)(),t=new Blob([JSON.stringify({timestamp:new Date().toISOString(),version:"1.0",data:{projects:e.projects||[],users:e.users||[],allocations:e.allocations||[],positions:e.positions||[],entities:e.entities||[],startMonth:e.startMonth,startYear:e.startYear,systemUsers:e.systemUsers||[]}},null,2)],{type:"application/json"}),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download=`sola-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r),alert("Backup created successfully!")},size:"sm",children:"Create Backup"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded bg-white",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium",children:"Import Backup"}),(0,t.jsx)("div",{className:"text-xs text-gray-600",children:"Restore data from backup file"})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("input",{type:"file",accept:".json",onChange:e=>{let t=e.target.files?.[0];if(!t)return;let r=new FileReader;r.onload=e=>{try{let t=e.target?.result,r=JSON.parse(t);if(!r.data||"object"!=typeof r.data)throw Error("Invalid backup file structure");if(confirm("This will overwrite all current data. Are you sure you want to continue?")){let e=r.data;(0,n.setCurrentUserData)({projects:e.projects||[],users:e.users||[],allocations:e.allocations||[],positions:e.positions||[],entities:e.entities||[],startMonth:e.startMonth,startYear:e.startYear,systemUsers:e.systemUsers||[]}),b(e.entities||[]),$(),alert("Backup imported successfully! Please refresh the page to see all changes.")}}catch(e){alert("Error importing backup: "+e.message)}},r.readAsText(t),e.target.value=""},className:"text-xs file:mr-2 file:py-1 file:px-2 file:rounded file:border-0 file:text-xs file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})})]})]}),(0,t.jsx)("div",{className:"mt-3 p-2 bg-yellow-50 border border-yellow-200 rounded",children:(0,t.jsxs)("p",{className:"text-xs text-yellow-800",children:[(0,t.jsx)("strong",{children:"Warning:"})," Importing a backup will overwrite all current data. Make sure to create a backup before importing."]})})]})})]})]})}):null}let o=Array.from({length:10},(e,t)=>2024+t);function d(){let[e,d]=(0,r.useState)(null),[c,m]=(0,r.useState)(null),[x,u]=(0,r.useState)(()=>{{let e=(0,n.getCurrentSystemUser)();if(e?.role==="admin"){let e=(0,n.getCurrentUserData)();return console.log("[v0] Admin loading own data:",e.projects),e.projects}{let e=(0,n.getSystemUsers)().find(e=>"admin"===e.role&&e.isActive);if(e){let t=(0,n.getUserData)(e.email);return console.log("[v0] System user loading admin data:",t.projects),t.projects}}}return[]}),[h,p]=(0,r.useState)(()=>{{let e=(0,n.getCurrentSystemUser)();if(e?.role==="admin"){let e=(0,n.getCurrentUserData)();return e.users.length>0?e.users:[{id:"1",name:"John Doe",department:"Engineering"},{id:"2",name:"Jane Smith",department:"Design"},{id:"3",name:"Bob Johnson",department:"Product"}]}{let e=(0,n.getSystemUsers)().find(e=>"admin"===e.role&&e.isActive);if(e){let t=(0,n.getUserData)(e.email);return t.users.length>0?t.users:[{id:"1",name:"John Doe",department:"Engineering"},{id:"2",name:"Jane Smith",department:"Design"},{id:"3",name:"Bob Johnson",department:"Product"}]}}}return[{id:"1",name:"John Doe",department:"Engineering"},{id:"2",name:"Jane Smith",department:"Design"},{id:"3",name:"Bob Johnson",department:"Product"}]}),[g,b]=(0,r.useState)(()=>{{let e=(0,n.getCurrentSystemUser)();if(e?.role==="admin")return(0,n.getCurrentUserData)().allocations;{let e=(0,n.getSystemUsers)().find(e=>"admin"===e.role&&e.isActive);if(e)return(0,n.getUserData)(e.email).allocations}}return[]}),[f,j]=(0,r.useState)(()=>{{let e=(0,n.getCurrentSystemUser)();if(e?.role==="admin")return(0,n.getCurrentUserData)().positions;{let e=(0,n.getSystemUsers)().find(e=>"admin"===e.role&&e.isActive);if(e)return(0,n.getUserData)(e.email).positions}}return[]});(0,r.useEffect)(()=>{let e=(0,n.getCurrentUser)(),t=(0,n.getCurrentSystemUser)();e&&t?(d(e),m(t.role)):window.location.href="/login"},[]),(0,r.useEffect)(()=>{e&&(console.log("[v0] Saving projects for user:",e,x),(0,n.setCurrentUserData)({projects:x}))},[x,e]),(0,r.useEffect)(()=>{e&&(0,n.setCurrentUserData)({users:h})},[h,e]),(0,r.useEffect)(()=>{e&&(0,n.setCurrentUserData)({allocations:g})},[g,e]),(0,r.useEffect)(()=>{e&&(0,n.setCurrentUserData)({positions:f})},[f,e]);let[y,v]=(0,r.useState)(null),[N,w]=(0,r.useState)(()=>(0,n.getCurrentUserData)().startMonth??0),[C,k]=(0,r.useState)(()=>(0,n.getCurrentUserData)().startYear??2024);(0,r.useEffect)(()=>{e&&(0,n.setCurrentUserData)({startMonth:N,startYear:C})},[N,C,e]);let[S,D]=(0,r.useState)(null),[I,M]=(0,r.useState)(0),[$,E]=(0,r.useState)(!1),[U,A]=(0,r.useState)(null),[B,T]=(0,r.useState)(!1),[Y,P]=(0,r.useState)(null),[F,z]=(0,r.useState)(""),[O,J]=(0,r.useState)(""),[R,L]=(0,r.useState)(""),[G,V]=(0,r.useState)(""),[W,H]=(0,r.useState)(""),[K,q]=(0,r.useState)(""),[Q,X]=(0,r.useState)("mon-fri"),[Z,_]=(0,r.useState)(null),[ee,et]=(0,r.useState)(null),[er,ea]=(0,r.useState)(!1),[es,el]=(0,r.useState)(!1),[en,ei]=(0,r.useState)("percentage"),[eo,ed]=(0,r.useState)(!1),[ec,em]=(0,r.useState)(null),[ex,eu]=(0,r.useState)(!1),[eh,ep]=(0,r.useState)(new Date().getFullYear()),[eg,eb]=(0,r.useState)({}),[ef,ej]=(0,r.useState)(null),[ey,ev]=(0,r.useState)(null),[eN,ew]=(0,r.useState)(()=>(0,n.getCurrentUserData)().entities||[]),eC="admin"===c,ek=x.filter(e=>{if(console.log("[DEBUG] Checking project:",e.name),console.log("[DEBUG] Project dates:",{startMonth:e.startMonth,startYear:e.startYear,endMonth:e.endMonth,endYear:e.endYear,hasEndMonth:!!e.endMonth,hasEndYear:!!e.endYear,endMonthType:typeof e.endMonth,endYearType:typeof e.endYear}),!e.endMonth||!e.endYear)return console.log("[DEBUG] Project has no end date, including - endMonth:",e.endMonth,"endYear:",e.endYear),!0;let t=e.startYear||2024,r=e.endYear||2024;console.log("[DEBUG] Using years:",{projectStartYear:t,projectEndYear:r});let a=new Date(t,e.startMonth||0,1),s=new Date(r,e.endMonth,1),l=new Date(C,N,1),n=new Date(C,N+11,1);console.log("[DEBUG] Date comparison:",{projectStartDate:a.toISOString().split("T")[0],projectEndDate:s.toISOString().split("T")[0],staffStartDate:l.toISOString().split("T")[0],staffEndDate:n.toISOString().split("T")[0]});let i=a<=n&&s>=l;return console.log("[DEBUG] Overlap result:",{projectStartBeforeStaffEnd:a<=n,projectEndAfterStaffStart:s>=l,overlaps:i}),i}),eS=["January","February","March","April","May","June","July","August","September","October","November","December"],eD=Array.from({length:12},(e,t)=>{let r=new Date(C,N+t,1),a=r.getMonth(),s=r.getFullYear();return{month:a,year:s,globalIndex:(s-2024)*12+a,display:`${eS[a].slice(0,3).toUpperCase()} ${String(s).slice(-2)}`}}),eI=(e,t)=>{let r=h.find(t=>t.id===e);if(!r?.endDate)return!1;let a=new Date(r.endDate);if(Number.isNaN(a.getTime()))return!1;let s=a.getMonth();return t>(a.getFullYear()-2024)*12+s},eM=(e,t)=>{let r=h.find(t=>t.id===e);if(!r?.startDate)return!0;let a=new Date(r.startDate);if(Number.isNaN(a.getTime()))return!0;let s=a.getMonth();return t>=(a.getFullYear()-2024)*12+s},e$=(e,t,r=1)=>{let a=new Date(e,t,1),s=new Date(e,t+1,0).getDate(),l=0;for(let e=1;e<=s;e++){a.setDate(e);let t=a.getDay();1===r?t>=1&&t<=5&&l++:t>=0&&t<=4&&l++}return l},eE=(e,t,r)=>{let a=h.find(t=>t.id===e);return a?Math.round(r/100*e$(Math.floor(t/12)+2024,t%12,+("mon-fri"===(a.workDays||"mon-fri")))):0},eU=(e,t,r)=>{if(ee&&null!==Z){let a=x.find(t=>t.id===e),s=a?.positions?.find(e=>e.monthIndex===Z&&e.name===t);if(!s||!s.percentage)return;let l=g.filter(r=>r.projectId===e&&r.monthIndex===Z&&(r.positionId===s.id||r.positionName===t)).reduce((e,t)=>e+(t.percentage||0),0),n=Math.max(0,s.percentage-l);if(n<=0)return;let i=r?Math.min(r,n):n,o={id:`alloc-${Date.now()}`,userId:ee,projectId:e,monthIndex:Z,percentage:i,positionId:s?.id,positionName:t};b(e=>[...e,o]),u(r=>r.map(r=>r.id===e?{...r,positions:r.positions?.map(e=>e.monthIndex===Z&&e.name===t?{...e,allocated:(e.allocated||0)+i}:e)}:r)),ea(!1),ej(null),eb({}),et(null),_(null)}},eA=e=>{let t=g.find(t=>t.id===e);t&&u(e=>e.map(e=>e.id===t.projectId?{...e,positions:e.positions?.map(e=>e.monthIndex===t.monthIndex&&e.name===t.positionName?{...e,allocated:Math.max(0,(e.allocated||0)-1)}:e)}:e)),b(t=>t.filter(t=>t.id!==e))},eB=(e,t)=>{b(r=>r.map(r=>r.id===e?{...r,percentage:t}:r)),D(null),M(0)},eT=(C-2024)*12+N,eY=eT+11,eP=h.filter(e=>{if(e.endDate){let t=new Date(e.endDate);if(!Number.isNaN(t.getTime())){let e=t.getMonth();if((t.getFullYear()-2024)*12+e<eT)return!1}}if(e.startDate){let t=new Date(e.startDate);if(!Number.isNaN(t.getTime())){let e=t.getMonth();if((t.getFullYear()-2024)*12+e>eY)return!1}}return!0}),eF=Array.from((ey?eP.filter(e=>g.some(t=>t.userId===e.id&&t.projectId===ey)):eP).reduce((e,t)=>(e.has(t.department)||e.set(t.department,[]),e.get(t.department).push(t),e),new Map)).map(([e,t])=>({department:e,users:t.sort((e,t)=>e.name.localeCompare(t.name))})).sort((e,t)=>e.department.localeCompare(t.department));return(0,t.jsxs)("div",{className:"space-y-4 p-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start gap-4",children:[(0,t.jsx)("div",{children:("admin"===c||"editor"===c||"viewer"===c)&&(0,t.jsx)(l,{projects:ek,positions:ek.flatMap(e=>e.positions||[]),months:eS,startMonth:N,startYear:C,onAddProject:e=>{u(t=>[...t,e])},onUpdateProject:(e,t)=>{console.log("[v0] updateProject called:",{projectId:e,updates:t}),console.trace("[v0] updateProject call stack"),u(r=>{let a=r.find(t=>t.id===e);if(a&&Object.entries(t).every(([e,t])=>a[e]===t))return console.log("[v0] Skipping update: no actual changes detected"),r;let s=r.map(r=>r.id===e?{...r,...t}:r);return console.log("[v0] projects after update:",s),s})},onDeleteProject:e=>{u(t=>t.filter(t=>t.id!==e)),b(t=>t.filter(t=>t.projectId!==e))},onUpdatePositions:e=>{u(x.map(t=>({...t,positions:e.filter(e=>e.projectId===t.id)}))),b(g.map(t=>{let r=e.find(e=>e.projectId===t.projectId&&e.monthIndex===t.monthIndex&&e.name===t.positionName);return r&&t.percentage>r.percentage?{...t,percentage:r.percentage}:t}))},onProjectSelect:ev,selectedProjectId:ey,onCleanupAllocations:(e,t)=>{b(r=>{let a=r.filter(r=>!!(r.projectId!==e||r.positionId&&t.includes(r.positionId))),s=r.filter(r=>r.projectId===e&&(!r.positionId||!t.includes(r.positionId)));return s.length>0&&u(t=>t.map(t=>t.id===e?{...t,positions:t.positions?.map(e=>{let t=s.filter(t=>t.positionId===e.id).reduce((e,t)=>e+(t.percentage||0),0);return{...e,allocated:Math.max(0,(e.allocated||0)-t)}})}:t)),a})},currentUserRole:c})}),(0,t.jsxs)("div",{className:"flex gap-4 items-end",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Starting Month"}),(0,t.jsx)("select",{value:N,onChange:e=>w(Number.parseInt(e.target.value)),className:"border rounded px-2 py-1",children:eS.map((e,r)=>(0,t.jsx)("option",{value:r,children:e},e))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Starting Year"}),(0,t.jsx)("select",{value:C,onChange:e=>k(Number.parseInt(e.target.value)),className:"border rounded px-2 py-1",children:o.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2 rounded-full",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[ey&&(0,t.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:[(0,t.jsxs)("span",{children:["Filtered by: ",x.find(e=>e.id===ey)?.name]}),(0,t.jsx)("button",{onClick:()=>ev(null),className:"text-blue-600 hover:text-blue-800 font-bold",children:"Ã—"})]}),("admin"===c||"editor"===c)&&(0,t.jsx)(a.Button,{onClick:()=>{P(null),z(""),J(""),L(""),V(""),H(""),q(""),X("mon-fri"),T(!0)},variant:"default",size:"sm",className:"bg-blue-900 hover:bg-blue-800 text-white",children:"+ New Staff"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"View:"}),(0,t.jsxs)("div",{className:"flex border rounded overflow-hidden",children:[(0,t.jsx)("button",{onClick:()=>ei("percentage"),className:`px-3 py-1 text-sm font-medium transition-colors ${"percentage"===en?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"% View"}),(0,t.jsx)("button",{onClick:()=>ei("days"),className:`px-3 py-1 text-sm font-medium transition-colors ${"days"===en?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"Days View"})]})]}),(0,t.jsx)("button",{onClick:()=>{let e="",t=["Staff",...eD.map(e=>e.display)];e+=t.join(",")+"\n",eF.forEach(t=>{e+=`${t.department},
`,t.users.forEach(t=>{let r=[t.name];eD.forEach(e=>{let a=g.filter(r=>r.userId===t.id&&r.monthIndex===e.globalIndex);if(a.length>0){let s,l=a.reduce((e,t)=>e+(t.percentage||0),0);"days"===en?(s=eE(t.id,e.globalIndex,l),r.push(`${s} days`)):(s=Math.round(l),r.push(`${s}%`))}else eM(t.id,e.globalIndex)?eI(t.id,e.globalIndex)?r.push("ended"):r.push(""):r.push("not started")}),e+=r.join(",")+"\n"})});let r=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),s=URL.createObjectURL(r),l=`staff-allocation-${en}-${new Date().toISOString().split("T")[0]}.csv`;a.setAttribute("href",s),a.setAttribute("download",l),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)},className:"px-3 py-1 text-sm bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors ml-4",children:"Export to Excel"}),(0,t.jsx)("button",{onClick:()=>eu(!0),className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700 transition-colors ml-2",title:"Show Project Gantt Chart",children:"ðŸ“Š Gantt Chart"})]}),(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsxs)("div",{className:"text-right mr-4",children:[(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Current User"}),(0,t.jsx)("div",{className:"font-medium",children:e}),(0,t.jsx)("div",{className:"text-xs text-gray-500 capitalize",children:c})]}),"admin"===c&&(0,t.jsxs)(a.Button,{onClick:()=>el(!0),variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),"Users"]}),(0,t.jsxs)(a.Button,{onClick:()=>{(0,n.getCurrentUser)()&&(0,n.setCurrentUserData)({startMonth:N,startYear:C}),(0,n.clearCurrentUser)(),window.location.href="/login"},variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Logout"]})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,t.jsxs)("thead",{children:[(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"border border-gray-300 p-2 bg-gray-100 w-42",children:"Staff"}),eD.map((e,r)=>{let a=e$(e.year,e.month,1),s=e$(e.year,e.month,0);return(0,t.jsx)("th",{className:"border border-gray-300 p-2 bg-gray-100 w-32 cursor-pointer hover:bg-gray-200 text-sm",onClick:()=>{var t;em({year:Math.floor((t=e.globalIndex)/12)+2024,month:t%12,globalIndex:t}),ed(!0)},children:(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{children:e.display}),(0,t.jsxs)("div",{className:"text-[10px] text-gray-600 mt-1",children:[(0,t.jsxs)("div",{children:["Mon-Fri: ",a]}),(0,t.jsxs)("div",{children:["Sun-Thu: ",s]})]})]})},r)})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"border border-gray-300 bg-gray-50 w-42 text-xs text-muted-foreground",children:"Unallocated"}),eD.map(e=>{let r=ek.flatMap(t=>(t.positions?.filter(t=>t.monthIndex===e.globalIndex)||[]).map(r=>{let a,s,l=g.filter(a=>a.projectId===t.id&&a.monthIndex===e.globalIndex&&a.positionId===r.id).reduce((e,t)=>e+(t.percentage||0),0),n=Math.max(0,r.percentage-l);if(n<=0)return null;if("days"===en){let t=Math.round(n/100*e$(e.year,e.month,1));a=t,s=`${t} days`}else a=Math.round(n),s=`${a}%`;return{projectId:t.id,projectName:t.name,projectColor:t.color,positionId:r.id,positionName:r.name||"Position",percentage:n,displayValue:a,displayText:s}}).filter(e=>null!=e));return(0,t.jsx)("td",{className:"border border-gray-300 bg-gray-50 p-1 align-top",style:{verticalAlign:"top"},children:(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:r.map(e=>(0,t.jsx)("div",{className:"flex items-center h-8 rounded overflow-hidden bg-gray-200 text-[9px] text-white",style:{minWidth:"50px",maxWidth:"120px"},title:`${e.projectName} - ${e.positionName} (${e.displayText} unallocated)`,children:(0,t.jsxs)("div",{className:"h-full flex items-center justify-center px-1 text-center leading-tight",style:{backgroundColor:e.projectColor||"#3b82f6",width:"100%"},children:[e.positionName," (",e.displayText,")"]})},`${e.projectId}-${e.positionId}`))})},e.globalIndex)})]})]}),(0,t.jsx)("tbody",{children:eF.map(e=>(0,t.jsxs)(r.default.Fragment,{children:[(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:eD.length+1,className:"border border-gray-300 p-1 font-semibold text-xs text-gray-800 bg-cyan-200",children:e.department})}),e.users.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"border border-gray-300 p-1 w-42",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,t.jsx)("span",{className:"text-xs leading-tight",children:e.name}),"admin"===c&&(0,t.jsx)("button",{onClick:()=>{var t;let r;return t=e.id,void((r=h.find(e=>e.id===t))&&(P(t),z(r.name),J(r.department),L(r.entity||""),V(r.vendorAC||""),H(r.startDate||""),q(r.endDate||""),X(r.workDays||"mon-fri"),T(!0)))},className:"text-blue-600 hover:text-blue-800 text-xs",children:"âœï¸"})]})}),eD.map(r=>(0,t.jsx)(s,{userId:e.id,monthIndex:r.globalIndex,allocations:g.filter(t=>t.userId===e.id&&t.monthIndex===r.globalIndex),project:ek.find(e=>e.id===g[0]?.projectId),projects:ek,users:h,month:r,userEnded:eI(e.id,r.globalIndex),userNotStarted:!eM(e.id,r.globalIndex),viewMode:en,getDaysFromPercentage:eE,readOnly:"viewer"===c,onEdit:e=>{D(e);let t=g.find(t=>t.id===e);t&&M(t.percentage)},onSaveEdit:eB,onRemove:eA,onEmptyCellClick:()=>((e,t)=>{if(!eC)return;console.log("[v0] Empty cell clicked:",{userId:e,monthIndex:t,selectedMonth:y});let r=h.find(t=>t.id===e);if(r?.endDate){let e=new Date(r.endDate);if(!Number.isNaN(e.getTime())){let r=e.getMonth();if(t>(e.getFullYear()-2024)*12+r)return}}if(r?.startDate){let e=new Date(r.startDate);if(!Number.isNaN(e.getTime())){let r=e.getMonth();if(t<(e.getFullYear()-2024)*12+r)return}}et(e),_(t),ea(!0)})(e.id,r.globalIndex)},`${e.id}-${r.globalIndex}`))]},e.id))]},e.department))})]})})]}),B&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 w-96",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-4",children:Y?"Edit User":"Add User"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Name"}),(0,t.jsx)("input",{type:"text",value:F,onChange:e=>z(e.target.value),className:"w-full border rounded px-2 py-1",placeholder:"User name"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Department"}),(0,t.jsx)("input",{type:"text",value:O,onChange:e=>J(e.target.value),className:"w-full border rounded px-2 py-1",placeholder:"Department"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Entity"}),(0,t.jsxs)("select",{value:R,onChange:e=>L(e.target.value),className:"w-full border rounded px-2 py-1",children:[(0,t.jsx)("option",{value:"",children:"Select Entity"}),eN.map(e=>(0,t.jsx)("option",{value:e.name,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Vendor AC"}),(0,t.jsx)("input",{type:"text",value:G,onChange:e=>V(e.target.value),className:"w-full border rounded px-2 py-1",placeholder:"Vendor AC"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Start Date"}),(0,t.jsx)("input",{type:"date",value:W,onChange:e=>H(e.target.value),className:"w-full border rounded px-2 py-1 text-sm"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"End Date"}),(0,t.jsx)("input",{type:"date",value:K,onChange:e=>q(e.target.value),className:"w-full border rounded px-2 py-1 text-sm"}),(0,t.jsx)("p",{className:"mt-1 text-[11px] text-gray-500",children:"Leave blank if working indefinitely."})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Work Days"}),(0,t.jsxs)("select",{value:Q,onChange:e=>X(e.target.value),className:"w-full border rounded px-2 py-1 text-sm",children:[(0,t.jsx)("option",{value:"mon-fri",children:"Monday - Friday"}),(0,t.jsx)("option",{value:"sun-thu",children:"Sunday - Thursday"})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 justify-end",children:[Y&&(0,t.jsx)(a.Button,{variant:"destructive",onClick:()=>{p(e=>e.filter(e=>e.id!==Y)),b(e=>e.filter(e=>e.userId!==Y)),T(!1)},children:"Delete"}),(0,t.jsx)(a.Button,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),(0,t.jsx)(a.Button,{onClick:()=>{if(F.trim()){if(Y)p(e=>e.map(e=>e.id===Y?{...e,name:F,department:O,entity:R||void 0,vendorAC:G||void 0,startDate:W||void 0,endDate:K||void 0,workDays:Q}:e));else{let e={id:`user-${Date.now()}`,name:F,department:O,entity:R||void 0,vendorAC:G||void 0,startDate:W||void 0,endDate:K||void 0,workDays:Q};p(t=>[...t,e])}T(!1),P(null),z(""),J(""),L(""),V(""),H(""),q(""),X("mon-fri")}},children:"Save"})]})]})]})}),er&&null!==Z&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 w-[500px] max-h-[80vh] overflow-y-auto",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Select Position"}),(0,t.jsx)("div",{className:"space-y-3",children:x.flatMap(e=>(e.positions||[]).filter(e=>e.monthIndex===Z&&(e.percentage||0)>0).map(t=>{let r=g.filter(r=>r.projectId===e.id&&r.monthIndex===Z&&r.positionName===t.name).reduce((e,t)=>e+(t.percentage||0),0),a=Math.max(0,(t.percentage||0)-r),s=ee?eE(ee,Z,a):0,l=ee?eE(ee,Z,r):0;return{...t,projectId:e.id,projectName:e.name,projectColor:e.color,available:a,availableDays:s,allocated:r,allocatedDays:l}}).filter(e=>e.available>0).map(e=>{let r=`${e.projectId}-${e.id}`,a=ef===r,s=eg[r]||"";return(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3 hover:bg-blue-50 transition-colors",style:{borderLeft:`4px solid ${e.projectColor}`},children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.name||"Unnamed"}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:e.projectName})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"text-sm font-medium",children:[Math.round(e.available),"% (",e.availableDays," days)"]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[Math.round(e.allocated),"% (",e.allocatedDays," days) allocated"]})]})]}),(0,t.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-3",children:(0,t.jsx)("div",{className:"h-2 rounded-full transition-all duration-300",style:{width:`${e.allocated/e.percentage*100}%`,backgroundColor:e.projectColor}})}),(0,t.jsx)("div",{className:"space-y-2",children:a?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"number",min:"0",max:Math.round(e.available),value:s,onChange:e=>{eb({...eg,[r]:e.target.value})},className:"flex-1 px-3 py-2 border border-gray-300 rounded text-sm",placeholder:`Enter % (max: ${Math.round(e.available)})`}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"%"})]}),ee&&(0,t.jsx)("div",{className:"text-xs text-gray-500",children:s?`${Math.round(Number(s)/100*eE(ee,Z,100))} days`:"0 days"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>{let t=Number(s);t>0&&t<=e.available&&eU(e.projectId,e.name||"",t)},disabled:!s||0>=Number(s)||Number(s)>e.available,className:"flex-1 px-3 py-2 bg-green-600 text-white rounded text-sm hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Allocate Custom"}),(0,t.jsx)("button",{onClick:()=>{ej(null),eb({...eg,[r]:""})},className:"flex-1 px-3 py-2 bg-gray-400 text-white rounded text-sm hover:bg-gray-500 transition-colors",children:"Cancel"})]})]}):(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("button",{onClick:()=>{eU(e.projectId,e.name||"",e.available)},className:"flex-1 px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors",children:["Allocate Full (",Math.round(e.available),"%)"]}),(0,t.jsx)("button",{onClick:()=>{ej(r),eb({...eg,[r]:Math.round(e.available).toString()})},className:"flex-1 px-3 py-2 bg-gray-600 text-white rounded text-sm hover:bg-gray-700 transition-colors",children:"Custom Amount"})]})})]},r)}))}),x.every(e=>!e.positions?.some(e=>e.monthIndex===Z&&(e.percentage||0)>0))&&(0,t.jsx)("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:"No positions available for this month. Add positions in the project settings."}),(0,t.jsx)(a.Button,{variant:"outline",onClick:()=>{ea(!1),ej(null),eb({})},className:"w-full mt-4",children:"Close"})]})}),(0,t.jsx)(i,{isOpen:es,onClose:()=>el(!1)}),eo&&ec&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-4 w-full max-w-7xl max-h-[95vh] overflow-y-auto mx-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"text-base font-bold",children:["Staff Allocation Detail - ",eS[ec.month]," ",ec.year]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"View:"}),(0,t.jsxs)("div",{className:"flex border rounded overflow-hidden",children:[(0,t.jsx)("button",{onClick:()=>ei("percentage"),className:`px-2 py-1 text-xs font-medium transition-colors ${"percentage"===en?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"% View"}),(0,t.jsx)("button",{onClick:()=>ei("days"),className:`px-2 py-1 text-xs font-medium transition-colors ${"days"===en?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"Days View"})]}),(0,t.jsx)("button",{onClick:()=>{if(!ec)return;let e="",t=["Staff",...ek.map(e=>e.name),"Total"];e+=t.join(",")+"\n",eF.forEach(t=>{e+=`${t.department},
`,t.users.forEach(t=>{let r=[t.name];ek.forEach(e=>{let a=g.filter(r=>r.userId===t.id&&r.projectId===e.id&&r.monthIndex===ec.globalIndex);if(a.length>0){let e,s=a.reduce((e,t)=>e+(t.percentage||0),0);"days"===en?(e=Math.round(eE(t.id,ec.globalIndex,s)),r.push(`${e} days`)):(e=Math.round(s),r.push(`${e}%`))}else r.push("")});let a=g.filter(e=>e.userId===t.id&&e.monthIndex===ec.globalIndex).reduce((e,t)=>e+(t.percentage||0),0);if("days"===en){let e=Math.round(eE(t.id,ec.globalIndex,a));r.push(`${e} days`)}else r.push(`${Math.round(a)}%`);e+=r.join(",")+"\n"})});let r=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),s=URL.createObjectURL(r),l=`staff-allocation-detail-${eS[ec.month]}-${ec.year}-${en}-${new Date().toISOString().split("T")[0]}.csv`;a.setAttribute("href",s),a.setAttribute("download",l),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)},className:"px-2 py-1 text-xs bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors ml-3",children:"Export to Excel"})]})]}),(0,t.jsx)("button",{onClick:()=>{ed(!1),em(null)},className:"px-2 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors text-xs",children:"Ã— Close"})]}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full border-collapse border border-gray-300 text-xs",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"border border-gray-300 p-1 bg-gray-100 w-32 text-xs",children:"Staff"}),ek.map(e=>{var r;let a,s;return(0,t.jsx)("th",{className:"border border-gray-300 p-1 bg-gray-100 min-w-24 text-xs",style:{backgroundColor:e.color,color:(a=parseInt((r=e.color).slice(1,3),16),s=parseInt(r.slice(3,5),16),(299*a+587*s+114*parseInt(r.slice(5,7),16))/1e3>128?"#000":"#fff")},children:e.name},e.id)}),(0,t.jsx)("th",{className:"border border-gray-300 p-1 bg-gray-100 w-32 text-xs",children:"Total"})]})}),(0,t.jsx)("tbody",{children:eF.map(e=>(0,t.jsxs)(r.default.Fragment,{children:[(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:ek.length+2,className:"border border-gray-300 p-1 font-semibold text-xs text-gray-800 bg-cyan-200",children:e.department})}),e.users.map(e=>{let r,a,s,l,n,i;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"border border-gray-300 p-1 text-xs",children:e.name}),ek.map(r=>{let a=g.filter(t=>t.userId===e.id&&t.monthIndex===ec.globalIndex).filter(e=>e.projectId===r.id);return(0,t.jsx)("td",{className:"border border-gray-300 p-0.5 text-center",children:a.length>0?(0,t.jsx)("div",{className:"flex flex-col gap-0.5",children:a.map(a=>{let s=r.positions?.find(e=>e.id===a.positionId),l="days"===en?eE(e.id,ec.globalIndex,a.percentage):Math.round(a.percentage||0),n="days"===en?`${Math.round(l)} days`:`${l}%`;return(0,t.jsx)("div",{className:"text-[10px] px-1 py-0.5 rounded text-white leading-tight",style:{backgroundColor:r.color},title:`${s?.name||"Position"} - ${Math.round(a.percentage||0)}%`,children:n},a.id)})}):(0,t.jsx)("div",{className:"text-[10px] text-gray-400",children:"-"})},r.id)}),(0,t.jsx)("td",{className:"border border-gray-300 p-0.5 text-center text-xs font-medium",children:(r=g.filter(t=>t.userId===e.id&&t.monthIndex===ec.globalIndex).reduce((e,t)=>e+(t.percentage||0),0),a=eE(e.id,ec.globalIndex,r),s=Math.round(r),l=Math.round(a),n="#F59E0B",i="transparent",s>=100?s>100?(n="#10B981",i="#EF4444"):(n="#10B981",i="transparent"):(n="#F59E0B",i="transparent"),(0,t.jsx)("div",{className:"w-full",children:(0,t.jsxs)("div",{className:"w-full h-3 rounded relative overflow-hidden",style:{backgroundColor:"#E5E7EB",border:"transparent"!==i?`2px solid ${i}`:"none"},children:[(0,t.jsx)("div",{className:"h-full rounded transition-all duration-300",style:{width:`${Math.min(r,100)}%`,backgroundColor:n}}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-[9px] font-medium",children:"days"===en?`${l} days`:`${s}%`})]})}))})]},e.id)})]},e.department))})]})})]})}),ex&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-6xl max-h-[90vh] overflow-y-auto mx-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"Project Gantt Chart"}),(0,t.jsx)("button",{onClick:()=>eu(!1),className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"Ã—"})]}),(0,t.jsx)("div",{className:"space-y-4",children:0===x.length?(0,t.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No projects to display in Gantt chart"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"bg-gray-50 p-3 rounded-lg",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Project Timeline (Monthly View)"}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:["Based on today's date: ",new Date().toLocaleDateString()]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-xs font-medium text-gray-600",children:"Start Year:"}),(0,t.jsx)("select",{value:eh,onChange:e=>ep(Number(e.target.value)),className:"border border-gray-300 rounded px-2 py-1 text-xs bg-white",children:(()=>{let e=x.flatMap(e=>[e.startYear||2024,e.endYear||2024]),r=Math.min(...e,new Date().getFullYear()-2),a=Math.max(...e,new Date().getFullYear()+2),s=[];for(let e=r;e<=a;e++)s.push(e);return s.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})()})]})]})}),(()=>{let e,r,a,s=[],l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];for(let e=eh;e<eh+2;e++)for(let t=0;t<12;t++)s.push({year:e,month:t,label:`${l[t]} ${e}`});let n=new Date,i=n.getFullYear(),o=n.getMonth(),d=s.findIndex(e=>e.year===i&&e.month===o);return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"border rounded-lg overflow-hidden relative",children:[d>=0&&(0,t.jsx)("div",{className:"absolute top-0 bottom-0 w-0.5 bg-red-500 z-10 pointer-events-none",style:{left:`calc((3 / (months.length + 3)) * 100% + ${(d+.5)*(97/(s.length+3))}%)`},children:(0,t.jsx)("div",{className:"absolute -top-2 -left-3 w-6 h-4 bg-red-500 text-white text-xs rounded flex items-center justify-center font-bold",children:"Today"})}),(0,t.jsxs)("div",{className:"grid bg-gray-100",style:{gridTemplateColumns:"3fr repeat(24, 1fr)"},children:[(0,t.jsx)("div",{className:"p-0.5 text-xs font-medium text-gray-700 border-r",children:"Project"}),s.map((e,r)=>(0,t.jsxs)("div",{className:"p-0 text-xs font-medium text-center text-gray-700 border-r last:border-r-0",children:[(0,t.jsx)("div",{className:"text-xs",children:e.label.split(" ")[0]}),(0,t.jsx)("div",{className:"text-xs font-bold",children:e.label.split(" ")[1]})]},`${e.year}-${e.month}`))]}),(e=x.filter(e=>{let t=new Date(e.startYear||2024,e.startMonth||0,1),r=new Date(e.endYear||2024,e.endMonth||11,1);return n>=t&&n<=r})).length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"p-0.5 bg-blue-50 text-xs font-medium text-blue-700 border-b",style:{gridColumn:"1 / -1"},children:["ðŸ”µ Ongoing (",e.length,")"]}),e.map(e=>{let r=new Date(e.startYear||2024,e.startMonth||0,1),a=new Date(e.endYear||2024,e.endMonth||11,1);return(a.getTime()-r.getTime())/864e5,(n.getTime()-r.getTime())/864e5,(0,t.jsxs)("div",{className:"grid border-b hover:bg-gray-50 relative",style:{gridTemplateColumns:"3fr repeat(24, 1fr)"},children:[(0,t.jsx)("div",{className:"p-0.5 border-r",children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded flex-shrink-0",style:{backgroundColor:e.color}}),(0,t.jsx)("span",{className:"text-xs font-medium truncate",children:e.name})]})}),s.map((s,l)=>{let d=new Date(s.year,s.month,1),c=new Date(s.year,s.month+1,0),m=r<d?d:r,x=a>c?c:a,u=m<=x,h=Math.ceil((c.getTime()-d.getTime())/864e5),p=u?Math.ceil((x.getTime()-m.getTime())/864e5):0,g=s.year===i&&s.month===o&&n>=r&&n<=a;return(0,t.jsx)("div",{className:"border-r last:border-r-0 p-0",children:u?(0,t.jsxs)("div",{className:"relative h-3 bg-gray-200 rounded overflow-hidden",children:[(0,t.jsx)("div",{className:"h-full rounded transition-all duration-300",style:{width:`${u?p/h*100:0}%`,backgroundColor:e.color,opacity:g?1:.8}}),g&&(0,t.jsx)("div",{className:"absolute inset-0 border-2 border-blue-400 rounded pointer-events-none"})]}):(0,t.jsx)("div",{className:"h-3"})},`${s.year}-${s.month}`)})]},e.id)})]}):null,(r=x.filter(e=>n>new Date(e.endYear||2024,e.endMonth||11,1))).length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"p-0.5 bg-green-50 text-xs font-medium text-green-700 border-b",style:{gridColumn:"1 / -1"},children:["ðŸŸ¢ Completed (",r.length,")"]}),r.map(e=>{let r=new Date(e.startYear||2024,e.startMonth||0,1),a=new Date(e.endYear||2024,e.endMonth||11,1);return(0,t.jsxs)("div",{className:"grid border-b hover:bg-gray-50",style:{gridTemplateColumns:"3fr repeat(24, 1fr)"},children:[(0,t.jsx)("div",{className:"p-0.5 border-r",children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded flex-shrink-0",style:{backgroundColor:e.color}}),(0,t.jsx)("span",{className:"text-xs font-medium truncate",children:e.name})]})}),s.map(s=>{let l=new Date(s.year,s.month,1),n=new Date(s.year,s.month+1,0),i=r<l?l:r,o=a>n?n:a,d=i<=o,c=Math.ceil((n.getTime()-l.getTime())/864e5),m=d?Math.ceil((o.getTime()-i.getTime())/864e5):0;return(0,t.jsx)("div",{className:"border-r last:border-r-0 p-0",children:d?(0,t.jsx)("div",{className:"relative h-3 bg-gray-200 rounded overflow-hidden",children:(0,t.jsx)("div",{className:"h-full rounded transition-all duration-300",style:{width:`${d?m/c*100:0}%`,backgroundColor:e.color,opacity:.7}})}):(0,t.jsx)("div",{className:"h-3"})},`${s.year}-${s.month}`)})]},e.id)})]}):null,(a=x.filter(e=>n<new Date(e.startYear||2024,e.startMonth||0,1))).length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"p-0.5 bg-yellow-50 text-xs font-medium text-yellow-700 border-b",style:{gridColumn:"1 / -1"},children:["ðŸŸ¡ Planned (",a.length,")"]}),a.map(e=>{let r=new Date(e.startYear||2024,e.startMonth||0,1),a=new Date(e.endYear||2024,e.endMonth||11,1);return r.getTime(),n.getTime(),(0,t.jsxs)("div",{className:"grid border-b hover:bg-gray-50",style:{gridTemplateColumns:"3fr repeat(24, 1fr)"},children:[(0,t.jsx)("div",{className:"p-0.5 border-r",children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded flex-shrink-0",style:{backgroundColor:e.color}}),(0,t.jsx)("span",{className:"text-xs font-medium truncate",children:e.name})]})}),s.map(s=>{let l=new Date(s.year,s.month,1),n=new Date(s.year,s.month+1,0),i=r<l?l:r,o=a>n?n:a,d=i<=o,c=Math.ceil((n.getTime()-l.getTime())/864e5),m=d?Math.ceil((o.getTime()-i.getTime())/864e5):0;return(0,t.jsx)("div",{className:"border-r last:border-r-0 p-0",children:d?(0,t.jsx)("div",{className:"relative h-3 bg-gray-200 rounded overflow-hidden",children:(0,t.jsx)("div",{className:"h-full rounded transition-all duration-300",style:{width:`${d?m/c*100:0}%`,backgroundColor:e.color,opacity:.6,borderStyle:"dashed"}})}):(0,t.jsx)("div",{className:"h-3"})},`${s.year}-${s.month}`)})]},e.id)})]}):null]}),(0,t.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Timeline Range"}),(0,t.jsxs)("div",{className:"text-xs text-gray-600",children:["Showing: ",eh," - ",eh+1," (24 months)"]})]}),(0,t.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Summary"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3 text-xs",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"font-medium text-green-600",children:x.filter(e=>new Date>new Date(e.endYear||2024,e.endMonth||11,1)).length}),(0,t.jsx)("div",{className:"text-gray-500",children:"Completed"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"font-medium text-blue-600",children:x.filter(e=>{let t=new Date(e.startYear||2024,e.startMonth||0,1),r=new Date(e.endYear||2024,e.endMonth||11,1);return n>=t&&n<=r}).length}),(0,t.jsx)("div",{className:"text-gray-500",children:"Ongoing"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"font-medium text-yellow-600",children:x.filter(e=>new Date<new Date(e.startYear||2024,e.startMonth||0,1)).length}),(0,t.jsx)("div",{className:"text-gray-500",children:"Planned"})]})]})]})]})})()]})})]})})]})}e.s(["AllocationGrid",()=>d],38367)}]);